C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE OEM_PECI
OBJECT MODULE PLACED IN Code\Oem\OEM_PECI.OBJ
COMPILER INVOKED BY: C:\Program Files\KeilC\C51\BIN\C51.exe Code\Oem\OEM_PECI.C LA WL(1) CD OT(9,SIZE) NOAREGS OR INCDIR
                    -(.\Code\CORE\INCLUDE\;.\Code\OEM\INCLUDE\;.\Code\CHIP\INCLUDE\;.\Code\API\INCLUDE\)

line level    source

   1          /*-----------------------------------------------------------------------------
   2           * TITLE: OEM_PECI.C
   3           *
   4           * Author : Dino
   5           *
   6           * Note : These functions are reference only.
   7           *        Please follow your project software specification to do some modification.
   8           *---------------------------------------------------------------------------*/
   9          
  10          #include <CORE_INCLUDE.H>
  11          #include <OEM_INCLUDE.H>
  12          
  13          //-----------------------------------------------------------------------
  14          // Init Enable PECI interface function
  15          //-----------------------------------------------------------------------
  16          void Init_PECI(void)
  17          {
  18   1          GPCRF6 = ALT;                      
  19   1          GCR2 |= PECIE;      // Enable PECI
  20   1      }
  21          
  22          //-----------------------------------------------------------------------
  23          // Init Enable PECI interface function
  24          //-----------------------------------------------------------------------
  25          void PECI_Enable(void)
  26          {
  27   1          //GPCRF6 = ALT;   
  28   1      }
  29          
  30          //-----------------------------------------------------------------------
  31          // Init Disable PECI interface function
  32          //-----------------------------------------------------------------------
  33          void PECI_Disable(void)
  34          {
  35   1          //GPCRF6 = INPUT;   
  36   1      }
  37          
  38          //-----------------------------------------------------------------------
  39          // Init timer1 for interface time-out
  40          //-----------------------------------------------------------------------
  41          void PECI_InitTimeOutTimer(void)
  42          {
  43   1          TR1 = 0;                    // Disable timer1
  44   1          ET1 = 0;                    // Disable timer1 interrupt
  45   1          _nop_();
  46   1          _nop_();
  47   1          _nop_();
  48   1          _nop_();
  49   1          TH1 = Timer_30ms>>8;        // Set timer1 counter 30ms
  50   1          TL1 = Timer_30ms;           // Set timer1 counter 30ms
  51   1          TF1 = 0;                    // Clear overflow flag
  52   1          TR1 = 1;                    // Enable timer1
  53   1      }
  54          
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 2   

  55          //-----------------------------------------------------------------------
  56          // CRC-8 polynomial
  57          //-----------------------------------------------------------------------
  58          void PECI_CalcCRC8(BYTE sourcebyte)
  59          {
  60   1      #if PECI_Softwave_AWFCS    
                  BYTE temp;
                      PECI_CRC8 ^=sourcebyte;
                  temp = PECI_CRC8;
              
                  if(IS_MASK_CLEAR(temp, BIT7))
                  {
                      temp = temp<<1;
                      PECI_CRC8 ^= temp;
                  }
                  else
                  {
                      temp = temp<<1;
                      PECI_CRC8 ^= 0x09;
                      PECI_CRC8 ^= temp;
                  }
                  
                  if(IS_MASK_CLEAR(temp, BIT7))
                  {
                      temp = temp<<1;
                      PECI_CRC8 ^= temp;
                  }
                  else
                  {
                      temp = temp<<1;
                      PECI_CRC8 ^= 0x07;
                      PECI_CRC8 ^= temp;
                  }
              #endif    
  89   1      }
  90          
  91          //-----------------------------------------------------------------------
  92          // Enables the PECI host controller.
  93          //-----------------------------------------------------------------------
  94          void PECI_HostEnable(void)
  95          {
  96   1          HOCTLR |= (FIFOCLR+FCSERR_ABT+PECIHEN+CONCTRL);
  97   1      }
  98          
  99          //-----------------------------------------------------------------------
 100          // Disable the PECI host controller.
 101          //-----------------------------------------------------------------------
 102          void PECI_HostDisable(void)
 103          {
 104   1          HOCTLR = 0x00;
 105   1      }
 106          
 107          //-----------------------------------------------------------------------
 108          // The PECI host controller will perform the desired transaction.
 109          //-----------------------------------------------------------------------
 110          void PECI_HostControl(BYTE control)
 111          {
 112   1          HOCTLR |= control;
 113   1      }
 114          
 115          //-----------------------------------------------------------------------
 116          // Check PECI interface busy or not
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 3   

 117          // return : 
 118          //          0 : 30 ms time out
 119          //          1 : OK
 120          //-----------------------------------------------------------------------
 121          BYTE PECI_CheckHostBusy(void)
 122          {
 123   1          PECI_InitTimeOutTimer();    
 124   1      
 125   1          while (!TF1)
 126   1              { 
 127   2              if(IS_MASK_CLEAR(HOSTAR, HOBY))
 128   2              {
 129   3                  TR1=0;
 130   3                  TF1=0;
 131   3                  ET1=1;
 132   3                  break;
 133   3              }
 134   2          }
 135   1          
 136   1          if(TF1)
 137   1              {
 138   2              TR1=0;
 139   2                      TF1=0;
 140   2              ET1=1;
 141   2              return(0);
 142   2          }
 143   1          return(1);
 144   1      }
 145          
 146          //-----------------------------------------------------------------------
 147          // Check PECI interface finish or not
 148          // return : 
 149          //          0 : time-out or error
 150          //          1 : finish
 151          //-----------------------------------------------------------------------
 152          BYTE PECI_CheckHostFinish(void)
 153          {
 154   1          BYTE error;
 155   1          BYTE status,result;
 156   1          error = 0x04;           // Pre-set error
 157   1          
 158   1          PECI_InitTimeOutTimer();
 159   1          while (!TF1)
 160   1              { 
 161   2              status = HOSTAR;
 162   2      
 163   2              if(status!=0x00)
 164   2              {
 165   3                  if(IS_MASK_SET(status, FINISH))
 166   3                  {
 167   4                      error = 0x00;
 168   4                      break;
 169   4                  }
 170   3                  else if(IS_MASK_SET(status, RD_FCS_ERR))
 171   3                  {
 172   4                      error = 0x01;
 173   4                      break;
 174   4                  }
 175   3                  else if(IS_MASK_SET(status, WR_FCS_ERR))
 176   3                  {
 177   4                      error = 0x01;
 178   4                      break;
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 4   

 179   4                  }
 180   3                  else if(IS_MASK_SET(status, EXTERR))
 181   3                  {
 182   4                      SET_MASK(RSTC4,RPECI);  // Reset PECI interface
 183   4                      error = 0x02;
 184   4                      break;
 185   4                  }
 186   3                  else if(IS_MASK_SET(status, BUSERR))
 187   3                  {
 188   4                      SET_MASK(RSTC4,RPECI);  // Reset PECI interface
 189   4                      error = 0x02;
 190   4                      break;
 191   4                  }
 192   3                  else if(IS_MASK_SET(status, TEMPERR))
 193   3                  {
 194   4                      error = 0x03;
 195   4                      break;
 196   4                  }
 197   3              }
 198   2          }
 199   1      
 200   1          if(error!=0x00)
 201   1          {
 202   2              result=0x00;    // error
 203   2          }    
 204   1          else
 205   1          {
 206   2              result=0x01;    // finish
 207   2          }
 208   1      
 209   1          TR1=0;
 210   1          TF1=0;
 211   1          ET1=1;
 212   1          return(result);
 213   1      }
 214          
 215          //-----------------------------------------------------------------------
 216          // The function of clearing Host Status Register
 217          //-----------------------------------------------------------------------
 218          void ResetPECIStatus(void)
 219          {
 220   1          HOSTAR = 0xFE;
 221   1      }
 222          
 223          //-----------------------------------------------------------------------
 224          // PECI Ping function
 225          //  return : 
 226          //              1 : The targeted address of processor is able to respond
 227          //              0 : no respond
 228          //  Input : 
 229          //              (1) addr : The address of processor
 230          //              (2) ReadLen read length always 0
 231          //              (3) WriteLen Write length always 0
 232          //-----------------------------------------------------------------------
 233          BYTE PECI_Ping(BYTE addr, BYTE ReadLen, BYTE WriteLen)
 234          {
 235   1          BYTE done;
 236   1          done = 0x00;
 237   1          
 238   1          PECI_HostEnable();
 239   1          HOTRADDR = addr;
 240   1          HOWRLR = WriteLen;
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 5   

 241   1          HORDLR = ReadLen;
 242   1          
 243   1          if(PECI_CheckHostBusy())
 244   1          {
 245   2              PECI_HostControl(START);
 246   2              if(PECI_CheckHostFinish())
 247   2              {
 248   3                  done = 0x01;
 249   3              }
 250   2          }
 251   1      
 252   1          PECI_HostDisable();
 253   1          ResetPECIStatus();
 254   1          return(done);
 255   1      }
 256          
 257          //-----------------------------------------------------------------------
 258          // PECI get temperature command
 259          //  return : 
 260          //              1 : done
 261          //              0 : error
 262          //  Input : 
 263          //              (1) addr : The address of processor
 264          //              (2) *ReadData : the start address of variable to save data
 265          //              (3) ReadLen read length always 8
 266          //              (4) WriteLen Write length always 1
 267          //-----------------------------------------------------------------------
 268          BYTE PECI_GetDIB(BYTE addr, XBYTE *ReadData, BYTE ReadLen, BYTE WriteLen)
 269          {
 270   1          BYTE done, index;
 271   1          done = 0x00;
 272   1          
 273   1          PECI_HostEnable();
 274   1          HOTRADDR = addr;
 275   1          HOWRLR = WriteLen;
 276   1          HORDLR = ReadLen;
 277   1          HOCMDR = PECI_CMD_GetDIB;
 278   1          
 279   1          if(PECI_CheckHostBusy())
 280   1          {
 281   2              PECI_HostControl(START);
 282   2              if(PECI_CheckHostFinish())
 283   2              {
 284   3                  for(index=0x00;index<HORDLR;index++)
 285   3                  {
 286   4                      *(ReadData+index)=HORDDR;
 287   4                  }
 288   3                  done = 0x01;
 289   3              }
 290   2          }
 291   1      
 292   1          PECI_HostDisable();
 293   1          ResetPECIStatus();
 294   1          return(done);
 295   1      }
 296          
 297          //-----------------------------------------------------------------------
 298          // PECI get temperature command
 299          //  return : 
 300          //              1 : done
 301          //              0 : error
 302          //  Input : 
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 6   

 303          //              (1) addr : The address of processor
 304          //              (2) *ReadData : the start address of variable to save data
 305          //              (3) Domain : 0 or 1¡C 
 306          //                           0 : Domain 0, 1 : Domain 1¡C
 307          //              (4) ReadLen read length always 2
 308          //              (5) WriteLen Write length always 1
 309          //-----------------------------------------------------------------------
 310          BYTE PECI_GetTemp(BYTE addr, XBYTE *ReadData, BYTE Domain, BYTE ReadLen, BYTE WriteLen)
 311          {
 312   1          BYTE done;
 313   1          done = 0x00;
 314   1          
 315   1          PECI_HostEnable();
 316   1          HOTRADDR = addr;
 317   1          HOWRLR = WriteLen;
 318   1          HORDLR = ReadLen;
 319   1          if(Domain<2)
 320   1          {
 321   2              HOCMDR = PECI_CMD_GetTemp+Domain;
 322   2          }
 323   1          else
 324   1          {
 325   2              HOCMDR = PECI_CMD_GetTemp;
 326   2          }
 327   1          
 328   1          if(PECI_CheckHostBusy())
 329   1          {
 330   2              PECI_HostControl(START);
 331   2              if(PECI_CheckHostFinish())
 332   2              {
 333   3                  *ReadData=HORDDR;
 334   3                  *(++ReadData)=HORDDR;
 335   3                  done = 0x01;
 336   3              }
 337   2          }
 338   1      
 339   1          PECI_HostDisable();
 340   1          ResetPECIStatus();
 341   1          return(done);
 342   1      }
 343          
 344          //-----------------------------------------------------------------------
 345          // Read to the package configuration space (PCS) within the processor
 346          //  return : 
 347          //              1 : done
 348          //              0 : error
 349          //  Input : 
 350          //              (1) addr : The address of processor
 351          //              (2) *ReadData : the start address of variable to save data
 352          //              (3) Domain : 0 or 1¡C 
 353          //                           0 : Domain 0, 1 : Domain 1¡C
 354          //              (4) Retry   0 or 1
 355          //              (5) Index
 356          //              (6) LSB of parameter
 357          //              (7) MSB of parameter
 358          //              (8) ReadLen read length 2 or 3 or 5
 359          //              (9) WriteLen write length 5
 360          //-----------------------------------------------------------------------
 361          BYTE PECI_RdPkgConfig(BYTE addr, XBYTE *ReadData, BYTE Domain, BYTE Retry, BYTE Index, BYTE LSB, BYTE MSB,
             - BYTE ReadLen, BYTE WriteLen)
 362          {
 363   1          BYTE done, cunt;
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 7   

 364   1          done = 0x00;
 365   1          
 366   1          PECI_HostEnable();
 367   1          HOTRADDR = addr;
 368   1          HOWRLR = WriteLen;
 369   1          HORDLR = ReadLen;
 370   1          if(Domain<2)
 371   1          {
 372   2              HOCMDR = PECI_CMD_RdPkgConfig+Domain;
 373   2          }
 374   1          else
 375   1          {
 376   2              HOCMDR = PECI_CMD_RdPkgConfig;
 377   2          }
 378   1      
 379   1          if(Retry<2)
 380   1          {
 381   2              HOWRDR = (PECI_HostID<<1)+Retry;
 382   2          }
 383   1          else
 384   1          {
 385   2              HOWRDR = (PECI_HostID<<1);
 386   2          }
 387   1          
 388   1          HOWRDR = Index;
 389   1          HOWRDR = LSB;
 390   1          HOWRDR = MSB;
 391   1              
 392   1          if(PECI_CheckHostBusy())
 393   1          {
 394   2              PECI_HostControl(START);
 395   2              if(PECI_CheckHostFinish())
 396   2              {
 397   3                  if(HORDLR!=0x00)
 398   3                  {
 399   4                      for(cunt=0x00;cunt<HORDLR;cunt++)
 400   4                      {
 401   5                          if(cunt==0x00)
 402   5                          {
 403   6                              PECI_CompletionCode = HORDDR;
 404   6                          }
 405   5                          else
 406   5                          {
 407   6                              *(ReadData+cunt-1)=HORDDR;
 408   6                          }
 409   5                      }
 410   4      
 411   4                      if(PECI_CompletionCode == PECI_CC_Valid)
 412   4                      {
 413   5                          done = 0x01;
 414   5                      }
 415   4                      else
 416   4                      {
 417   5                          done = 0x00;
 418   5                      }
 419   4                  }
 420   3                  else
 421   3                  {
 422   4                      done = 0x00;
 423   4                  }
 424   3              }
 425   2          }
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 8   

 426   1      
 427   1          PECI_HostDisable();
 428   1          ResetPECIStatus();
 429   1          return(done);
 430   1      }
 431          
 432          //-----------------------------------------------------------------------
 433          // Write to the package configuration space (PCS) within the processor
 434          //  return : 
 435          //              1 : done
 436          //              0 : error
 437          //  Input : 
 438          //              (1) addr : The address of processor
 439          //              (2) *WriteData : the start address of variable to wirte data
 440          //              (3) Domain : 0 or 1¡C 
 441          //                           0 : Domain 0, 1 : Domain 1¡C
 442          //              (4) Retry   0 or 1
 443          //              (5) Index
 444          //              (6) LSB of parameter
 445          //              (7) MSB of parameter
 446          //              (8) ReadLen read length 1
 447          //              (9) WriteLen write length 0x07 or 0x08 or 0x0A
 448          //-----------------------------------------------------------------------
 449          BYTE PECI_WrPkgConfig(BYTE addr, XBYTE *WriteData, BYTE Domain, BYTE Retry, BYTE Index, BYTE LSB, BYTE MSB
             -, BYTE ReadLen, BYTE WriteLen)
 450          {
 451   1          BYTE done, cunt;
 452   1          done = 0x00;
 453   1          
 454   1          PECI_CompletionCode = 0x00;
 455   1          PECI_HostEnable();
 456   1          
 457   1          #if PECI_Softwave_AWFCS
                  PECI_CRC8 = 0x00;
                  #else
 460   1          PECI_HostControl(AWFCS_EN);
 461   1          #endif
 462   1          
 463   1          HOTRADDR = addr;
 464   1          PECI_CalcCRC8(addr);
 465   1          HOWRLR = WriteLen;
 466   1          PECI_CalcCRC8(WriteLen);
 467   1          HORDLR = ReadLen;
 468   1          PECI_CalcCRC8(ReadLen);
 469   1      
 470   1          if(Domain<2)
 471   1          {
 472   2              HOCMDR = PECI_CMD_WrPkgConfig+Domain;
 473   2              PECI_CalcCRC8(PECI_CMD_WrPkgConfig+Domain);
 474   2          }
 475   1          else
 476   1          {
 477   2              HOCMDR = PECI_CMD_WrPkgConfig;
 478   2              PECI_CalcCRC8(PECI_CMD_WrPkgConfig);
 479   2          }
 480   1      
 481   1          if(Retry<2)
 482   1          {
 483   2              HOWRDR = (PECI_HostID<<1)+Retry;
 484   2              PECI_CalcCRC8((PECI_HostID<<1)+Retry);
 485   2          }
 486   1          else
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 9   

 487   1          {
 488   2              HOWRDR = (PECI_HostID<<1);
 489   2              PECI_CalcCRC8(PECI_HostID<<1);
 490   2          }
 491   1      
 492   1          HOWRDR = Index;
 493   1          PECI_CalcCRC8(Index);
 494   1          HOWRDR = LSB;
 495   1          PECI_CalcCRC8(LSB);
 496   1          HOWRDR = MSB;
 497   1          PECI_CalcCRC8(MSB);
 498   1      
 499   1          for(cunt=0x00; cunt<(WriteLen-6); cunt++)
 500   1          {
 501   2              HOWRDR = *(WriteData+cunt);
 502   2              PECI_CalcCRC8(*(WriteData+cunt));
 503   2          }
 504   1      
 505   1          #if PECI_Softwave_AWFCS
                  PECI_CRC8 ^= 0x80;          // Inverted MSb of preliminary FCS reslut
                  HOWRDR = PECI_CRC8;
                  #endif
 509   1               
 510   1          if(PECI_CheckHostBusy())
 511   1          {
 512   2              PECI_HostControl(START);
 513   2              if(PECI_CheckHostFinish())
 514   2              {
 515   3                  PECI_CompletionCode = HORDDR;
 516   3                  if(PECI_CompletionCode == PECI_CC_Valid)
 517   3                  {
 518   4                      done = 0x01;
 519   4                  }
 520   3                  else
 521   3                  {
 522   4                      done = 0x00;
 523   4                  }
 524   3              }
 525   2          }
 526   1      
 527   1          PECI_HostDisable();
 528   1          ResetPECIStatus();
 529   1          return(done);
 530   1      }
 531          
 532          //-----------------------------------------------------------------------
 533          // Read to Model Specific Registers function
 534          //  return : 
 535          //              1 : done
 536          //              0 : error
 537          //  Input : 
 538          //              (1) addr : The address of processor
 539          //              (2) *ReadData : the start address of variable to save data
 540          //              (3) Domain : 0 or 1¡C 
 541          //                           0 : Domain 0, 1 : Domain 1¡C
 542          //              (4) Retry   0 or 1
 543          //              (5) ProcessorID
 544          //              (6) LSB of parameter
 545          //              (7) MSB of parameter
 546          //              (8) ReadLen read length 0x02 or 0x03 or 0x05 or 0x09
 547          //              (9) WriteLen write length 0x05
 548          //-----------------------------------------------------------------------
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 10  

 549          BYTE PECI_RdIAMSR(BYTE addr, XBYTE *ReadData, BYTE Domain, BYTE Retry, BYTE ProcessorID, BYTE LSB, BYTE MS
             -B, BYTE ReadLen, BYTE WriteLen)
 550          {
 551   1          BYTE done, cunt;
 552   1          done = 0x00;
 553   1          
 554   1          PECI_HostEnable();
 555   1          HOTRADDR = addr;
 556   1          HOWRLR = WriteLen;
 557   1          HORDLR = ReadLen;
 558   1          if(Domain<2)
 559   1          {
 560   2              HOCMDR = PECI_CMD_RdIAMSR+Domain;
 561   2          }
 562   1          else
 563   1          {
 564   2              HOCMDR = PECI_CMD_RdIAMSR;
 565   2          }
 566   1      
 567   1          if(Retry<2)
 568   1          {
 569   2              HOWRDR = (PECI_HostID<<1)+Retry;
 570   2          }
 571   1          else
 572   1          {
 573   2              HOWRDR = (PECI_HostID<<1);
 574   2          }
 575   1          
 576   1          HOWRDR = ProcessorID;
 577   1          HOWRDR = LSB;
 578   1          HOWRDR = MSB;
 579   1              
 580   1          if(PECI_CheckHostBusy())
 581   1          {
 582   2              PECI_HostControl(START);
 583   2              if(PECI_CheckHostFinish())
 584   2              {
 585   3                  for(cunt=0x00;cunt<HORDLR;cunt++)
 586   3                  {
 587   4                      if(cunt==0x00)
 588   4                      {
 589   5                          PECI_CompletionCode = HORDDR;
 590   5                      }
 591   4                      else
 592   4                      {
 593   5                          *(ReadData+cunt-1)=HORDDR;
 594   5                      }
 595   4                  }
 596   3      
 597   3                  if(PECI_CompletionCode == PECI_CC_Valid)
 598   3                  {
 599   4                      done = 0x01;
 600   4                  }
 601   3                  else
 602   3                  {
 603   4                      done = 0x00;
 604   4                  }
 605   3              }
 606   2          }
 607   1      
 608   1          PECI_HostDisable();
 609   1          ResetPECIStatus();
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 11  

 610   1          return(done);
 611   1      }
 612          
 613          // ----------------------------------------------------------------------------
 614          // Clear PECI turbo control variables
 615          // ----------------------------------------------------------------------------
 616          void PECI_ClearTCVariables(void)
 617          {
 618   1          PECI_ClearPowerSKUUnit();
 619   1          PowerLimit1TDP=0x00;
 620   1          PowerLimit2Max=0x00; 
 621   1          PECI_PL2Watts=0x00;
 622   1          PowerLimit1Tau=0x00;
 623   1          PECI_Ctrl = 0x00;
 624   1          PECI_Algorithm_Delay = 0x00;
 625   1      }
 626          
 627          // ----------------------------------------------------------------------------
 628          // Clear Power SKU unit variables
 629          // ----------------------------------------------------------------------------
 630          void PECI_ClearPowerSKUUnit(void)
 631          {
 632   1          PECI_PowerUnit = 0x00;
 633   1          PECI_EnergyUnit = 0x00;
 634   1          PECI_TimeUnit = 0x00;
 635   1      }
 636          
 637          // ----------------------------------------------------------------------------
 638          // The function of PECI3.0 Package power SKU unit read
 639          // Output:
 640          //          0 : Fail
 641          //          1 : OK
 642          // ----------------------------------------------------------------------------
 643          BYTE PECI_ReadPowerUnit(void)
 644          {
 645   1          BYTE result;
 646   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_PPSH, 0x00, 0x00, 0x0
             -5, 0x05))
 647   1          {
 648   2              PECI_PowerUnit = (PECIReadBuffer[0]&0x0F);      // bit 0 ~ bit3
 649   2              PECI_EnergyUnit = (PECIReadBuffer[1]&0x1F);     // bit 8 ~ bit12
 650   2              PECI_TimeUnit = (PECIReadBuffer[2]&0x0F);       // bit 16 ~ bit19
 651   2              result = 0x01;
 652   2          }
 653   1          else
 654   1          {
 655   2              result = 0x00;
 656   2          }
 657   1          return(result);
 658   1      }
 659          
 660          // ----------------------------------------------------------------------------
 661          // The function of PECI3.0 Package power limit 1 write 
 662          // Output:
 663          //          0 : Fail
 664          //          1 : OK
 665          // ----------------------------------------------------------------------------
 666          BYTE PECI_WritePowerLimit1(void)
 667          {
 668   1          BYTE reslut;
 669   1          WORD UnitofPower;
 670   1          WORD UnitofTau;
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 12  

 671   1          WORD PL1_TDPWatts;
 672   1          BYTE PL1_PL1T;
 673   1          
 674   1          UnitofPower = 1<<PECI_PowerUnit;
 675   1          PL1_TDPWatts = PowerLimit1TDP * UnitofPower;
 676   1      
 677   1          UnitofTau = 1<<PECI_TimeUnit;
 678   1          //PL1_PL1T = (PowerLimit1Tau * UnitofTau)<<1;
 679   1          PL1_PL1T = 0x6E<<1;
 680   1              
 681   1          PECIWriteBuffer[0]=(PL1_TDPWatts);
 682   1          PECIWriteBuffer[1]=(PL1_TDPWatts)>>8;   // Set power limit 1 TDP value
 683   1          PECIWriteBuffer[2]=PL1_PL1T;            // bit17 ~ bit23 Power_Limit_1_Time
 684   1          PECIWriteBuffer[3]=0x00;
 685   1          
 686   1          if(PECI_WrPkgConfig(PECI_CPU_ADDR, &PECIWriteBuffer, PECI_Domain_0, 0, PECI_Index_PPL1, 0x00, 0x00, 0x
             -01, 0x0A))
 687   1          {
 688   2              reslut = 0x01;
 689   2          }
 690   1          else
 691   1          {
 692   2              reslut = 0x00;
 693   2          }
 694   1          return(reslut);
 695   1      }
 696          
 697          
 698          // ----------------------------------------------------------------------------
 699          // The function of PECI3.0 Package power limit 1 read
 700          // Output:
 701          //          0 : Fail
 702          //          1 : OK
 703          // ----------------------------------------------------------------------------
 704          BYTE PECI_ReadPowerLimit1(void)
 705          {
 706   1          BYTE reslut;
 707   1          
 708   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_PPL1, 0x00, 0x00, 0x0
             -5, 0x05))
 709   1          {
 710   2              PowerLimit1TDP = (PECIReadBuffer[0]+((PECIReadBuffer[1] &= 0x7F) *256))/(1<<PECI_PowerUnit);
 711   2              PowerLimit1Tau = PECIReadBuffer[2]>>1;
 712   2              reslut = 0x01;
 713   2          }
 714   1          else
 715   1          {
 716   2              reslut = 0x00;
 717   2          }
 718   1          return(reslut);
 719   1      }
 720          
 721          // ----------------------------------------------------------------------------
 722          // The function of battery mode turbo control
 723          // ----------------------------------------------------------------------------
 724          void PECI_ACToDCModeTurboCtrl(void)
 725          {
 726   1          BYTE retry;
 727   1          
 728   1          PCH_PROCHOT_ON();
 729   1          for(retry=0x00;retry<5;retry++)         // Re-try
 730   1          {
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 13  

 731   2              PECI_SETPL2Watts(PowerLimit1TDP);
 732   2              if(IS_MASK_CLEAR(PECI_Ctrl, SetPL2Request))
 733   2              {
 734   3                  break;
 735   3              }
 736   2          }
 737   1          PCH_PROCHOT_OFF();
 738   1      }
 739          
 740          // ----------------------------------------------------------------------------
 741          // The function of setting PL2 watts
 742          // ----------------------------------------------------------------------------
 743          void PECI_SETPL2Watts(BYTE watts)
 744          {
 745   1          PECI_PL2Watts = watts;
 746   1          SET_MASK(PECI_Ctrl, SetPL2Request);
 747   1          PECI_WritePowerLimit2(PECI_PL2Watts);
 748   1      }
 749          
 750          // ----------------------------------------------------------------------------
 751          // The function of PECI3.0 Package power limit 2 write 
 752          // ----------------------------------------------------------------------------
 753          void PECI_WritePowerLimit2(BYTE watts)
 754          {
 755   1           WORD UnitofPower;
 756   1           WORD PL2_SettingWatts;
 757   1          //if(PECI_ReadPowerUnit()==0x01)
 758   1          //{
 759   1              UnitofPower = 1<<PECI_PowerUnit;
 760   1              PL2_SettingWatts = watts * UnitofPower;
 761   1              
 762   1              PECIWriteBuffer[0]=(PL2_SettingWatts);
 763   1              PECIWriteBuffer[1]=(PL2_SettingWatts)>>8;   // Set power limit 2 value
 764   1              PECIWriteBuffer[1]|=0x80;                   // Enables power limit 2
 765   1              PECIWriteBuffer[2]=0x00;
 766   1              PECIWriteBuffer[3]=0x00;
 767   1              if(PECI_WrPkgConfig(PECI_CPU_ADDR, &PECIWriteBuffer, PECI_Domain_0, 0, PECI_Index_PPL2, 0x00, 0x00
             -, 0x01, 0x0A))
 768   1              {
 769   2                  CLEAR_MASK(PECI_Ctrl, SetPL2Request);
 770   2              }
 771   1              else
 772   1              {
 773   2      
 774   2              }
 775   1          //}
 776   1          //else
 777   1          //{
 778   1      
 779   1          //}
 780   1      }
 781          
 782          // ----------------------------------------------------------------------------
 783          // The function of PECI3.0 Package power limit 2 read 
 784          // ----------------------------------------------------------------------------
 785          void PECI_ReadPowerLimit2(void)
 786          {
 787   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_PPL2, 0x00, 0x00, 0x0
             -5, 0x05))
 788   1          {
 789   2              ;
 790   2          }
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 14  

 791   1          else
 792   1          {
 793   2              ;
 794   2          }
 795   1      }
 796          
 797          // ----------------------------------------------------------------------------
 798          // The function of PECI3.0 CPU temperature read
 799          // ----------------------------------------------------------------------------
 800          void PECI_ReadCPUTemp(void)
 801          {
 802   1          WORD cputemp;
 803   1          BYTE tempoffset;
 804   1          
 805   1          if(PECI_GetTemp(PECI_CPU_ADDR,&PECIReadBuffer,PECI_Domain_0,2,1)) // Read OK
 806   1          {
 807   2              cputemp = (PECIReadBuffer[1]<<8)+PECIReadBuffer[0]; // MSB+LSB
 808   2              cputemp = (~cputemp)+1;                             // 2's complement
 809   2              tempoffset = cputemp>>6;                            // 1/64 degrees centigrade
 810   2              if(tempoffset<=CPUTjmax)        // PECI thermal reading temperature readings are                
 811   2              {                               // not reliable at temperatures above Tjmax
 812   3                  PECI_CPU_temp = CPUTjmax-tempoffset;  // Save temperature
 813   3              }
 814   2              else
 815   2              {
 816   3      
 817   3              }
 818   2          }
 819   1          else        // Read fail
 820   1          {
 821   2      
 822   2          }
 823   1      }
 824          
 825          // ----------------------------------------------------------------------------
 826          // The function of PECI3.0 Read the Maximum Allowed Processor Temperature
 827          // ----------------------------------------------------------------------------
 828          void PECI_ReadCPUTJMAX(void)
 829          {
 830   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_TTR, 0x00, 0x00, 0x05
             -, 0x05))
 831   1          {
 832   2              ReadCPUTjmaxCUNT = 0x00;
 833   2              CPUTjmax = PECIReadBuffer[2];
 834   2          }
 835   1          else
 836   1          {
 837   2              if(++ReadCPUTjmaxCUNT>=PECI_Read_TjmaxTO)
 838   2              {
 839   3                  ReadCPUTjmaxCUNT = 0x00;
 840   3                  CPUTjmax = PECI_CPU_Tjmax; // Set default value if re-try PECI_Read_TjmaxTO times
 841   3              }
 842   2          }
 843   1      }
 844          
 845          // ----------------------------------------------------------------------------
 846          // The function of PECI3.0 DRAM rank channel temperature read
 847          // ----------------------------------------------------------------------------
 848          void PECI_ReadDRAMTemperature(void)
 849          {
 850   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_DRCTR, 0x00, 0x00, 0x
             -05, 0x05))
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 15  

 851   1          {
 852   2              TDIM0_temp = PECIReadBuffer[0];
 853   2              TDIM1_temp = PECIReadBuffer[1];
 854   2          }
 855   1          else
 856   1          {
 857   2              ;
 858   2          }
 859   1      }
 860          
 861          // ----------------------------------------------------------------------------
 862          // The function of PECI3.0 Package temperature read
 863          // ----------------------------------------------------------------------------
 864          void PECI_ReadPkgTemperature(void)
 865          {
 866   1          WORD pkgtemp;
 867   1          BYTE tempoffset;
 868   1          if(PECI_RdPkgConfig(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, PECI_Index_PTR, 0xFF, 0x00, 0x05
             -, 0x05))
 869   1          {
 870   2              pkgtemp = (PECIReadBuffer[1]<<8)+PECIReadBuffer[0]; // MSB+LSB
 871   2              pkgtemp = (~pkgtemp)+1;                             // 2's complement
 872   2              tempoffset = pkgtemp>>6;                            // 1/64 degrees centigrade
 873   2              if(tempoffset<=CPUTjmax)  // PECI thermal reading temperature readings are                
 874   2              {                               // not reliable at temperatures above Tjmax
 875   3                  TPkg_temp = CPUTjmax-tempoffset;  // Save temperature
 876   3              }
 877   2          }
 878   1          else
 879   1          {
 880   2              ;
 881   2          }
 882   1      }
 883          
 884          // ----------------------------------------------------------------------------
 885          // The example of PECI3.0 read MSR address 0x0400
 886          // ----------------------------------------------------------------------------
 887          void PECI_ReadMSRExample(void)
 888          {
 889   1          if(PECI_RdIAMSR(PECI_CPU_ADDR, &PECIReadBuffer, PECI_Domain_0, 0, 0, 0x00, 0x04, 0x09, 0x05))
 890   1          {
 891   2      
 892   2          }
 893   1          else
 894   1          {
 895   2      
 896   2          }
 897   1      }
 898          
 899          // ----------------------------------------------------------------------------
 900          // Get current platform total power
 901          // ----------------------------------------------------------------------------
 902          void PECI_CheckCurrentPlatformPower(void)
 903          {
 904   1      ///    WORD SysCurrent;
 905   1      ///    SysCurrent = Read_SYS_I();
 906   1          //PECI_SystemWatts
 907   1      }
 908          
 909          // ----------------------------------------------------------------------------
 910          // The Algorithm of AC turbo control
 911          // ----------------------------------------------------------------------------
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 16  

 912          void PECI_ACTurboControlAlgorithm(void)
 913          {
 914   1          BYTE NewPL2Watts,BATTERY_CHARGE_BUDGET,UpdatPL2;
 915   1          //if(PECI_PL2Watts==0x00)                   // Not ready
 916   1          //{
 917   1          //    return;
 918   1          //}
 919   1          
 920   1          if(IS_MASK_CLEAR(PECI_Ctrl, SetPL2Request)) // No any request of PL2 power setting
 921   1          {
 922   2              UpdatPL2=0x00;
 923   2              BATTERY_CHARGE_BUDGET=0x00;
 924   2      
 925   2      //        if(IS_MASK_SET(BT1_STATUS1,bat_InCharge))
 926   2      //        {
 927   2      //            if(BAT1_RSOC>50)
 928   2      //            {
 929   2      //                BATTERY_CHARGE_BUDGET = 0x00;   // 0W
 930   2      //            }
 931   2      //            else
 932   2      //            {
 933   2      //                BATTERY_CHARGE_BUDGET = 20;     // 20W
 934   2      //            }
 935   2      //        }
 936   2              
 937   2              NewPL2Watts = PECI_PL2Watts+PECI_AdaptorWatts-PECI_SystemWatts-BATTERY_CHARGE_BUDGET;
 938   2              
 939   2              if(NewPL2Watts>PowerLimit2Max)
 940   2              {
 941   3                  NewPL2Watts = PowerLimit2Max;
 942   3                  if(NewPL2Watts!=PECI_PL2Watts)
 943   3                  {
 944   4                      UpdatPL2=0x01;
 945   4                  }
 946   3                  //UpdatPL2=0x01;
 947   3              }
 948   2              else if(NewPL2Watts<PowerLimit1TDP)
 949   2              {
 950   3                  NewPL2Watts = PowerLimit1TDP;
 951   3                  if(NewPL2Watts!=PECI_PL2Watts)
 952   3                  {
 953   4                      UpdatPL2=0x01;
 954   4                  }
 955   3                  //UpdatPL2=0x01;
 956   3              }
 957   2              else
 958   2              {
 959   3                  if(NewPL2Watts!=PECI_PL2Watts)
 960   3                  {
 961   4                      UpdatPL2=0x01;
 962   4                  }
 963   3              }
 964   2      
 965   2              if(UpdatPL2==0x01)
 966   2              {
 967   3                  PECI_SETPL2Watts(NewPL2Watts);
 968   3              }
 969   2          }
 970   1          else
 971   1          {
 972   2              PECI_WritePowerLimit2(PECI_PL2Watts);
 973   2          }
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 17  

 974   1      }
 975          
 976          // ----------------------------------------------------------------------------
 977          // decide adaptor watts
 978          // ----------------------------------------------------------------------------
 979          void ChecknSetAdaptorWatts(void)
 980          {
 981   1          PECI_AdaptorWatts = ACPowerWatts;   // Set 65w adaptor
 982   1          PowerLimit2Max = PowerLimit2Max_Value;
 983   1      }
 984          
 985          // ----------------------------------------------------------------------------
 986          // PECI power limit 2 control function
 987          // ----------------------------------------------------------------------------
 988          void PECI_PowerCtrlAlgorithm(void)
 989          {
 990   1          switch(PECI_PowerCtrlStep)
 991   1          {
 992   2              case PECI_Step_Start:
 993   2                  if(SystemIsS0)
 994   2                  {
 995   3                      if(1)    // AC mode //IS_MASK_SET(POWER_FLAG1, adapter_in)
 996   3                      {
 997   4                          ChecknSetAdaptorWatts();
 998   4                          SetPECIPowerCtrlStep(PECI_Step_ReadPSKUUnit);
 999   4                      }
1000   3                      else                                // DC mode
1001   3                      {
1002   4      
1003   4                      }
1004   3                  }
1005   2                  break;
1006   2      
1007   2              case PECI_Step_ReadPSKUUnit:
1008   2                  if(PECI_ReadPowerUnit()==0x01)      // Read power SKU unit OK
1009   2                  {
1010   3                      SetPECIPowerCtrlStep(PECI_Step_ReadPL1);
1011   3                  }
1012   2                  break;
1013   2      
1014   2              case PECI_Step_ReadPL1:
1015   2                  if(PECI_ReadPowerLimit1()==0x01)    // Read power limit 1 done
1016   2                  {
1017   3                      if(PowerLimit1TDP!=0x00)
1018   3                      {
1019   4                          SetPECIPowerCtrlStep(PECI_Step_Algorithm);
1020   4                      }
1021   3                      else
1022   3                      {
1023   4                          PowerLimit1TDP = PowerLimit1_TDP;
1024   4                          SetPECIPowerCtrlStep(PECI_Step_WritePL1);
1025   4                      }
1026   3                  }
1027   2                  break;
1028   2      
1029   2              case PECI_Step_WritePL1:
1030   2                  if(PECI_WritePowerLimit1()==0x01)
1031   2                  {
1032   3                      SetPECIPowerCtrlStep(PECI_Step_Algorithm);
1033   3                  }
1034   2                  break;
1035   2                      
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 18  

1036   2              case PECI_Step_Algorithm:
1037   2                  if(++PECI_Algorithm_Delay>=AlgorithmDelayTime)
1038   2                  {
1039   3                      PECI_Algorithm_Delay = 0x00;
1040   3                      PECI_ACTurboControlAlgorithm();
1041   3                  }
1042   2                  break;
1043   2                  
1044   2              case PECI_Step_Stop:
1045   2                  break;
1046   2              
1047   2              case PECI_Step_StopRequest:
1048   2                  PECI_ClearTCVariables();
1049   2                  SetPECIPowerCtrlStep(PECI_Step_Stop);
1050   2                  break;
1051   2                      
1052   2              default:
1053   2                  break;
1054   2          }  
1055   1      }
1056          
1057          // ----------------------------------------------------------------------------
1058          // CPU Power control via PECI
1059          // ----------------------------------------------------------------------------
1060          void PECI_PowerCtrlCenter(void)
1061          {
1062   1          if(SystemIsS0)          // For PECI stress tool
1063   1          {
1064   2              if(IS_MASK_SET(PSTB_CmdStatus, ServivePECIStressTool))
1065   2              {
1066   3                  if(++PSTB_Timer >=0x02)    // 10 ms
1067   3                  {
1068   4                      PSTB_Timer=0x00;
1069   4                      if(PSTB_RepeatIntervalCount==0x00)
1070   4                      {
1071   5                          ProcessPSTCmd();
1072   5                      }
1073   4                      else
1074   4                      {
1075   5                          PSTB_RepeatIntervalCount--;
1076   5                      }
1077   4                  }
1078   3                  return;
1079   3              }
1080   2          }
1081   1      
1082   1          if(SystemIsS0)
1083   1          {
1084   2              PECI_CheckCurrentPlatformPower();       // Get current platform total power every 5ms
1085   2          }
1086   1      
1087   1          #ifdef PECI_Support
1088   1              #if ACTurboControlAlgorithm
                      PECI_PowerCtrlAlgorithm();
                      #endif
1091   1          #endif
1092   1          
1093   1      
1094   1      }
1095          
1096          // ----------------------------------------------------------------------------
1097          // Set PECI power control step
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 19  

1098          // ----------------------------------------------------------------------------
1099          void SetPECIPowerCtrlStep(BYTE step)
1100          {
1101   1          PECI_PowerCtrlStep = step;
1102   1      }
1103          
1104          // ****************************************************************************
1105          // PECI Stress Tool
1106          // ****************************************************************************
1107          // ----------------------------------------------------------------------------
1108          // Process PECP stress tool command
1109          // ----------------------------------------------------------------------------
1110          void ProcessPSTCmd(void)
1111          {
1112   1          BYTE writelen, readlen,bufindex;
1113   1          BYTE error;
1114   1          XBYTE *bufpoint;
1115   1          
1116   1          error = 0x00;
1117   1          bufindex = 0x00;
1118   1      
1119   1          bufpoint = &PSTB_RepeatCycle;
1120   1          
1121   1          if(PSTB_RepeatCycle!=0x00)
1122   1          {
1123   2              writelen = PECI_StressToolBuf[PSTB_WriteLength];
1124   2              readlen = PECI_StressToolBuf[PSTB_ReadLength];
1125   2              
1126   2              PECI_HostEnable();
1127   2              HOTRADDR = PECI_StressToolBuf[PSTB_ClientAddress];
1128   2              HOWRLR = PECI_StressToolBuf[PSTB_WriteLength];
1129   2              HORDLR = PECI_StressToolBuf[PSTB_ReadLength];
1130   2                  
1131   2              if(writelen!=0x00)
1132   2              {
1133   3                  HOCMDR = PECI_StressToolBuf[PSTB_CmdCode];
1134   3                  writelen--;
1135   3                  bufindex++;
1136   3              }
1137   2              if(PECI_StressToolBuf[PSTB_CmdCode]==PECI_CMD_WrPkgConfig)
1138   2              {
1139   3                  PECI_HostControl(AWFCS_EN);
1140   3                  writelen--;
1141   3              }
1142   2      
1143   2              while(writelen!=0x00)
1144   2              {
1145   3                  HOWRDR = PECI_StressToolBuf[PSTB_CmdCode+bufindex];
1146   3                  writelen--;
1147   3                  bufindex++;
1148   3              }
1149   2      
1150   2              if(PECI_CheckHostBusy())
1151   2              {
1152   3                  PECI_HostControl(START);
1153   3                  if(PECI_CheckHostFinish())  // OK
1154   3                  {
1155   4                      if(PECI_StressToolBuf[PSTB_CmdCode]==PECI_CMD_WrPkgConfig)
1156   4                      {
1157   5                          bufindex++;         // AWFCS
1158   5                      }
1159   4                      bufindex++;             // FCS
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 20  

1160   4      
1161   4                      while(readlen!=0x00)
1162   4                      {
1163   5                          PECI_StressToolBuf[PSTB_CmdCode+bufindex] = HORDDR;
1164   5                          readlen--;
1165   5                          bufindex++;
1166   5                      }
1167   4                      error = 0x00;
1168   4                  }
1169   3                  else                        // error
1170   3                  {
1171   4                      error = 0x01;
1172   4                  }
1173   3              }
1174   2              else
1175   2              {
1176   3                  error = 0x01;
1177   3              }
1178   2              
1179   2              PSTB_RepeatCycle--;
1180   2              PECI_StressToolBuf[PSTB_RepeatCycle3] = *bufpoint;
1181   2              bufpoint++;
1182   2              PECI_StressToolBuf[PSTB_RepeatCycle2] = *bufpoint;
1183   2              bufpoint++;
1184   2              PECI_StressToolBuf[PSTB_RepeatCycle1] = *bufpoint;
1185   2              bufpoint++;
1186   2              PECI_StressToolBuf[PSTB_RepeatCycle0] = *bufpoint;
1187   2              
1188   2              PSTB_RepeatIntervalCount = PECI_StressToolBuf[PSTB_RepeatInterval];
1189   2              PECI_HostDisable();
1190   2              ResetPECIStatus();
1191   2              
1192   2              if(error==0x01)
1193   2              {
1194   3                  if(PECI_StressToolBuf[PSTB_CmdCode]==PECI_CMD_WrPkgConfig)
1195   3                  {
1196   4                      bufindex++;             // AWFCS
1197   4                  }
1198   3                  bufindex++;                 // FCS
1199   3      
1200   3                  while(readlen!=0x00)        // Clear read length buffer
1201   3                  {
1202   4                      PECI_StressToolBuf[PSTB_CmdCode+bufindex] = 0x00;
1203   4                      readlen--;
1204   4                      bufindex++;
1205   4                  }
1206   3      
1207   3                  PECI_ErrorCount++;
1208   3                  if(PECI_StressToolBuf[PSTB_StopOnError]!=0x00)
1209   3                  {
1210   4                      CLEAR_MASK(PSTB_CmdStatus, ServivePECIStressTool);
1211   4                  }
1212   3              }
1213   2          }
1214   1          else
1215   1          {
1216   2              CLEAR_MASK(PSTB_CmdStatus, ServivePECIStressTool);
1217   2          }
1218   1      }
1219          
1220          // ----------------------------------------------------------------------------
1221          // Issue PECI command
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 21  

1222          // ----------------------------------------------------------------------------
1223          void PECI_PSTIssueCmd(void)
1224          {
1225   1          XBYTE *xptr;
1226   1          
1227   1          PECI_ErrorCount = 0x00;
1228   1          PSTB_Timer = 0x00;
1229   1          PSTB_RepeatIntervalCount = 0x00;
1230   1          SET_MASK(PSTB_CmdStatus, ServivePECIStressTool);
1231   1          xptr = &PSTB_RepeatCycle;
1232   1          *xptr = PECI_StressToolBuf[PSTB_RepeatCycle3];
1233   1          xptr++;
1234   1          *xptr = PECI_StressToolBuf[PSTB_RepeatCycle2];
1235   1          xptr++;
1236   1          *xptr = PECI_StressToolBuf[PSTB_RepeatCycle1];
1237   1          xptr++;
1238   1          *xptr = PECI_StressToolBuf[PSTB_RepeatCycle0];
1239   1      }
1240          
1241          // ----------------------------------------------------------------------------
1242          // End PECI command
1243          // ----------------------------------------------------------------------------
1244          void PECI_PSTEndCmd(void)
1245          {
1246   1          PECI_ClearPSTVariables();
1247   1      }
1248          
1249          // ----------------------------------------------------------------------------
1250          // Write PECI stress tool buffer command
1251          // ----------------------------------------------------------------------------
1252          void PECI_PSTWriteBuffer(void)
1253          {
1254   1          PECI_StressToolBuf[BufferLength-PM3DataCount] = PM3Data;
1255   1      }
1256          
1257          // ----------------------------------------------------------------------------
1258          // Read PECI stress tool buffer command
1259          // ----------------------------------------------------------------------------
1260          void PECI_PSTReadBuffer(void)
1261          {
1262   1          StressToolReadBufIndex = BufferLength;
1263   1          
1264   1          /*
1265   1          BYTE index, timeout;
1266   1      
1267   1          timeout = 0x00;
1268   1      
1269   1          for(index=0x00;index<BufferLength;index++)
1270   1          {
1271   1              TR1 = 0;                            // Disable timer1
1272   1              ET1 = 0;                            // Disable timer1 interrupt
1273   1              _nop_();
1274   1              _nop_();
1275   1              _nop_();
1276   1              _nop_();
1277   1              TH1 = Timer_30ms>>8;            // Set timer1 counter 30ms
1278   1              TL1 = Timer_30ms;               // Set timer1 counter 30ms
1279   1              TF1 = 0;                            // Clear overflow flag
1280   1              TR1 = 1;                            // Enable timer1
1281   1              
1282   1              while(IS_MASK_SET(PM3STS, P_OBF))
1283   1              {
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 22  

1284   1                  if(TF1)
1285   1                  {
1286   1                      timeout = 0x01;
1287   1                      break;
1288   1                  }
1289   1                  else
1290   1                  {
1291   1                      timeout = 0x00;
1292   1                  }
1293   1              }
1294   1              
1295   1              if(timeout==0x01)
1296   1              {
1297   1                  break;
1298   1              }
1299   1              else
1300   1              {
1301   1                  PMC3Output(PECI_StressToolBuf[index]);
1302   1              }
1303   1          }
1304   1      
1305   1          TR1 = 0;                        // Disable timer1
1306   1          TF1 = 0;                        // Clear overflow flag
1307   1          ET1 = 1;                        // Enable timer1 interrupt
1308   1          */
1309   1      }
1310          
1311          
1312          // ----------------------------------------------------------------------------
1313          // Read PECI error count command
1314          // ----------------------------------------------------------------------------
1315          void PECI_PSTReadErrorCount(void)
1316          {
1317   1          BYTE index, timeout;
1318   1          BYTE buffer[4];
1319   1          XBYTE *xptr;
1320   1      
1321   1          timeout = 0x00;
1322   1          
1323   1          xptr = &PECI_ErrorCount;
1324   1          buffer[3] = *xptr;
1325   1          xptr++;
1326   1          buffer[2] = *xptr;
1327   1          xptr++;
1328   1          buffer[1] = *xptr;
1329   1          xptr++;
1330   1          buffer[0] = *xptr;
1331   1      
1332   1      
1333   1          for(index=0x00;index<4;index++)
1334   1          {
1335   2              TR1 = 0;                            // Disable timer1
1336   2              ET1 = 0;                            // Disable timer1 interrupt
1337   2              _nop_();
1338   2              _nop_();
1339   2              _nop_();
1340   2              _nop_();
1341   2              TH1 = Timer_30ms>>8;            // Set timer1 counter 30ms
1342   2              TL1 = Timer_30ms;               // Set timer1 counter 30ms
1343   2              TF1 = 0;                            // Clear overflow flag
1344   2              TR1 = 1;                            // Enable timer1
1345   2              
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 23  

1346   2              while(IS_MASK_SET(PM3STS, P_OBF))
1347   2              {
1348   3                  if(TF1)
1349   3                  {
1350   4                      timeout = 0x01;
1351   4                      break;
1352   4                  }
1353   3                  else
1354   3                  {
1355   4                      timeout = 0x00;
1356   4                  }
1357   3              }
1358   2              
1359   2              if(timeout==0x01)
1360   2              {
1361   3                  break;
1362   3              }
1363   2              else
1364   2              {
1365   3      ///            PMC3Output(buffer[index]);
1366   3              }
1367   2          }
1368   1      
1369   1          TR1 = 0;                        // Disable timer1
1370   1          TF1 = 0;                        // Clear overflow flag
1371   1          ET1 = 1;                        // Enable timer1 interrupt
1372   1      }
1373          
1374          // ----------------------------------------------------------------------------
1375          // Read PECI status command
1376          // ----------------------------------------------------------------------------
1377          void PECI_PSTReadStatus(void)
1378          {
1379   1          TR1 = 0;                        // Disable timer1
1380   1          ET1 = 0;                        // Disable timer1 interrupt
1381   1          _nop_();
1382   1          _nop_();
1383   1          _nop_();
1384   1          _nop_();
1385   1          TH1 = Timer_30ms>>8;            // Set timer1 counter 30ms
1386   1          TL1 = Timer_30ms;               // Set timer1 counter 30ms
1387   1          TF1 = 0;                        // Clear overflow flag
1388   1          TR1 = 1;                        // Enable timer1
1389   1              
1390   1          while(IS_MASK_SET(PM3STS, P_OBF))
1391   1          {
1392   2              if(TF1)
1393   2              {
1394   3                  break;
1395   3              }
1396   2          }
1397   1      
1398   1          if(!TF1)
1399   1          {    
1400   2      ///        PMC3Output(PSTB_CmdStatus);
1401   2          }
1402   1      
1403   1          TR1 = 0;                        // Disable timer1
1404   1          TF1 = 0;                        // Clear overflow flag
1405   1          ET1 = 1;                        // Enable timer1 interrupt
1406   1      }
1407          
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 24  

1408          // ----------------------------------------------------------------------------
1409          // Clear PECI stress tool variables
1410          // ----------------------------------------------------------------------------
1411          void PECI_ClearPSTVariables(void)
1412          {
1413   1          PSTB_Timer = 0x00;
1414   1          PSTB_CmdStatus = 0x00; 
1415   1          PSTB_RepeatIntervalCount = 0x00;
1416   1          PSTB_RepeatCycle = 0x00;
1417   1          StressToolReadBufIndex = 0x00;
1418   1      }
1419          
1420          // ----------------------------------------------------------------------------
1421          // Send buffer data to PECI stress tool (5ms time base)
1422          // ----------------------------------------------------------------------------
1423          void PECI_SendBufferData(void)
1424          {
1425   1          if(StressToolReadBufIndex!=0x00)
1426   1          {
1427   2              if(IS_MASK_CLEAR(PM3STS, P_OBF))
1428   2              {
1429   3      ///            PMC3Output(PECI_StressToolBuf[BufferLength-StressToolReadBufIndex]);
1430   3                  StressToolReadBufIndex--;
1431   3              }
1432   2          }
1433   1      }
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 25  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Com00F0 (BEGIN)
0000         L?0241:
0000 A3                INC     DPTR
0001         L?0242:
0001 F0                MOVX    @DPTR,A
0002 E4                CLR     A
0003 A3                INC     DPTR
0004 F0                MOVX    @DPTR,A
0005         L?0243:
0005 A3                INC     DPTR
0006 F0                MOVX    @DPTR,A
0007 A3                INC     DPTR
0008 7405              MOV     A,#05H
000A F0                MOVX    @DPTR,A
000B A3                INC     DPTR
000C F0                MOVX    @DPTR,A
000D E4                CLR     A
000E FB                MOV     R3,A
000F 7F30              MOV     R7,#030H
0011 22                RET     
0012         L?0244:
0012         L?0245:
0012 F0                MOVX    @DPTR,A
0013 900000      R     MOV     DPTR,#bufpoint
0016 E4                CLR     A
0017 75F001            MOV     B,#01H
001A 120000      E     LCALL   ?C?IILDX
001D         L?0246:
001D 900000      R     MOV     DPTR,#bufpoint
0020 E0                MOVX    A,@DPTR
0021 FE                MOV     R6,A
0022 A3                INC     DPTR
0023 E0                MOVX    A,@DPTR
0024 F582              MOV     DPL,A
0026 8E83              MOV     DPH,R6
0028 E0                MOVX    A,@DPTR
0029 22                RET     
002A         L?0247:
002A         L?0248:
002A EC                MOV     A,R4
002B F0                MOVX    @DPTR,A
002C A3                INC     DPTR
002D ED                MOV     A,R5
002E F0                MOVX    @DPTR,A
002F         L?0249:
002F E4                CLR     A
0030 FC                MOV     R4,A
0031 120000      R     LCALL   PECI_HostEnable
0034 900000      E     MOV     DPTR,#HOTRADDR
0037 EF                MOV     A,R7
0038 F0                MOVX    @DPTR,A
0039 22                RET     
003A         L?0250:
003A         L?0251:
003A 7F01              MOV     R7,#01H
003C 120000      R     LCALL   _PECI_HostControl
003F 120000      R     LCALL   PECI_CheckHostFinish
0042 EF                MOV     A,R7
0043 22                RET     
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 26  

0044         L?0252:
0044         L?0253:
0044 900000      R     MOV     DPTR,#?_PECI_RdPkgConfig?BYTE+04H
0047         L?0254:
0047 7C00        E     MOV     R4,#HIGH PECIReadBuffer
0049 7D00        E     MOV     R5,#LOW PECIReadBuffer
004B E4                CLR     A
004C F0                MOVX    @DPTR,A
004D 22                RET     
004E         L?0255:
004E         L?0256:
004E 900000      E     MOV     DPTR,#PECI_PowerUnit
0051         L?0257:
0051 E0                MOVX    A,@DPTR
0052 FF                MOV     R7,A
0053 7401              MOV     A,#01H
0055 7E00              MOV     R6,#00H
0057 C8                XCH     A,R0
0058 EF                MOV     A,R7
0059 C8                XCH     A,R0
005A 08                INC     R0
005B 22                RET     
005C         L?0258:
005C         L?0259:
005C 120000      R     LCALL   PECI_HostDisable
005F 120000      R     LCALL   ResetPECIStatus
0062 CF                XCH     A,R7
0063 EC                MOV     A,R4
0064 CF                XCH     A,R7
0065 22                RET     
0066         L?0260:
0066 FE                MOV     R6,A
0067 E0                MOVX    A,@DPTR
0068 FA                MOV     R2,A
0069 A3                INC     DPTR
006A E0                MOVX    A,@DPTR
006B 2F                ADD     A,R7
006C F582              MOV     DPL,A
006E E4                CLR     A
006F 3A                ADDC    A,R2
0070 F583              MOV     DPH,A
0072 E582              MOV     A,DPL
0074 24FF              ADD     A,#0FFH
0076 F582              MOV     DPL,A
0078 E583              MOV     A,DPH
007A 34FF              ADDC    A,#0FFH
007C F583              MOV     DPH,A
007E EE                MOV     A,R6
007F F0                MOVX    @DPTR,A
0080 22                RET     
0081         L?0261:
0081         L?0262:
0081 900000      R     MOV     DPTR,#bufindex
0084 E0                MOVX    A,@DPTR
0085 2400        E     ADD     A,#LOW PECI_StressToolBuf+09H
0087 F582              MOV     DPL,A
0089 E4                CLR     A
008A 3400        E     ADDC    A,#HIGH PECI_StressToolBuf+09H
008C F583              MOV     DPH,A
008E 22                RET     
008F         L?0263:
008F A3                INC     DPTR
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 27  

0090 F0                MOVX    @DPTR,A
0091 E4                CLR     A
0092 A3                INC     DPTR
0093 F0                MOVX    @DPTR,A
0094 A3                INC     DPTR
0095 F0                MOVX    @DPTR,A
0096 A3                INC     DPTR
0097 04                INC     A
0098 F0                MOVX    @DPTR,A
0099 740A              MOV     A,#0AH
009B         L?0264:
009B A3                INC     DPTR
009C F0                MOVX    @DPTR,A
009D E4                CLR     A
009E FB                MOV     R3,A
009F 7F30              MOV     R7,#030H
00A1 22                RET     
00A2         L?0265:
00A2 F4                CPL     A
00A3 FF                MOV     R7,A
00A4 EE                MOV     A,R6
00A5 F4                CPL     A
00A6 FE                MOV     R6,A
00A7 EF                MOV     A,R7
00A8 2401              ADD     A,#01H
00AA FF                MOV     R7,A
00AB E4                CLR     A
00AC 3E                ADDC    A,R6
00AD F0                MOVX    @DPTR,A
00AE A3                INC     DPTR
00AF EF                MOV     A,R7
00B0 F0                MOVX    @DPTR,A
00B1 22                RET     
00B2         L?0266:
00B2 F0                MOVX    @DPTR,A
00B3 1E                DEC     R6
00B4         L?0267:
00B4 900000      R     MOV     DPTR,#bufindex
00B7 E0                MOVX    A,@DPTR
00B8 04                INC     A
00B9 F0                MOVX    @DPTR,A
00BA 22                RET     
00BB         L?0268:
00BB 900000      E     MOV     DPTR,#PECIReadBuffer+01H
00BE E0                MOVX    A,@DPTR
00BF         L?0269:
00BF FE                MOV     R6,A
00C0 900000      E     MOV     DPTR,#PECIReadBuffer
00C3 E0                MOVX    A,@DPTR
00C4 7C00              MOV     R4,#00H
00C6 2400              ADD     A,#00H
00C8 22                RET     
00C9         L?0270:
00C9         L?0271:
00C9 758DA6            MOV     TH1,#0A6H
00CC 758B29            MOV     TL1,#029H
00CF C28F              CLR     TF1
00D1 D28E              SETB    TR1
00D3 22                RET     
00D4         L?0272:
00D4         L?0273:
00D4 C28E              CLR     TR1
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 28  

00D6 C28F              CLR     TF1
00D8 D2AB              SETB    ET1
00DA 22                RET     
00DB         L?0274:
00DB         L?0275:
00DB E0                MOVX    A,@DPTR
00DC 900000      E     MOV     DPTR,#HORDLR
00DF F0                MOVX    @DPTR,A
00E0 EB                MOV     A,R3
00E1 C3                CLR     C
00E2 9402              SUBB    A,#02H
00E4 22                RET     
00E5         L?0277:
00E5         L?0278:
00E5 900000      E     MOV     DPTR,#HORDLR
00E8 E0                MOVX    A,@DPTR
00E9 FE                MOV     R6,A
00EA EF                MOV     A,R7
00EB C3                CLR     C
00EC 9E                SUBB    A,R6
00ED 22                RET     
00EE         L?0279:
00EE         L?0280:
00EE E0                MOVX    A,@DPTR
00EF 8F82              MOV     DPL,R7
00F1 8E83              MOV     DPH,R6
00F3 F0                MOVX    @DPTR,A
00F4 22                RET     
00F5         L?0281:
00F5 A3                INC     DPTR
00F6 F0                MOVX    @DPTR,A
00F7 7C00        E     MOV     R4,#HIGH PECIWriteBuffer
00F9 7D00        E     MOV     R5,#LOW PECIWriteBuffer
00FB 900000      R     MOV     DPTR,#?_PECI_WrPkgConfig?BYTE+04H
00FE F0                MOVX    @DPTR,A
00FF 22                RET     
0100         L?0282:
0100         L?0283:
0100 900000      E     MOV     DPTR,#HOWRDR
0103 7402              MOV     A,#02H
0105 F0                MOVX    @DPTR,A
0106 22                RET     
0107         L?0284:
0107 E0                MOVX    A,@DPTR
0108 900000      E     MOV     DPTR,#HOWRDR
010B F0                MOVX    @DPTR,A
010C 120000      R     LCALL   PECI_CheckHostBusy
010F EF                MOV     A,R7
0110 22                RET     
0111         L?0285:
0111 ED                MOV     A,R5
0112 2E                ADD     A,R6
0113 F582              MOV     DPL,A
0115 E4                CLR     A
0116 3C                ADDC    A,R4
0117 F583              MOV     DPH,A
0119 E0                MOVX    A,@DPTR
011A 22                RET     
011B         L?0286:
011B FF                MOV     R7,A
011C 900000      E     MOV     DPTR,#CPUTjmax
011F E0                MOVX    A,@DPTR
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 29  

0120 FE                MOV     R6,A
0121 EF                MOV     A,R7
0122 D3                SETB    C
0123 9E                SUBB    A,R6
0124 22                RET     
0125         L?0287:
0125 E0                MOVX    A,@DPTR
0126 FE                MOV     R6,A
0127 900000      E     MOV     DPTR,#PECI_PL2Watts
012A E0                MOVX    A,@DPTR
012B FD                MOV     R5,A
012C EE                MOV     A,R6
012D 6D                XRL     A,R5
012E 22                RET     
             ; FUNCTION Com00F0 (END)

             ; FUNCTION Init_PECI (BEGIN)
                                           ; SOURCE LINE # 16
                                           ; SOURCE LINE # 17
                                           ; SOURCE LINE # 18
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#GPCRF6
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 19
0005 900000      E     MOV     DPTR,#GCR2
0008 E0                MOVX    A,@DPTR
0009 4410              ORL     A,#010H
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 20
000C 22                RET     
             ; FUNCTION Init_PECI (END)

             ; FUNCTION PECI_Enable (BEGIN)
                                           ; SOURCE LINE # 25
                                           ; SOURCE LINE # 26
                                           ; SOURCE LINE # 28
0000 22                RET     
             ; FUNCTION PECI_Enable (END)

             ; FUNCTION PECI_Disable (BEGIN)
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
                                           ; SOURCE LINE # 36
0000 22                RET     
             ; FUNCTION PECI_Disable (END)

             ; FUNCTION PECI_InitTimeOutTimer (BEGIN)
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
                                           ; SOURCE LINE # 43
0000 C28E              CLR     TR1
                                           ; SOURCE LINE # 44
0002 C2AB              CLR     ET1
                                           ; SOURCE LINE # 45
0004 00                NOP     
                                           ; SOURCE LINE # 46
0005 00                NOP     
                                           ; SOURCE LINE # 47
0006 00                NOP     
                                           ; SOURCE LINE # 48
0007 00                NOP     
                                           ; SOURCE LINE # 49
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 30  

                                           ; SOURCE LINE # 50
                                           ; SOURCE LINE # 51
                                           ; SOURCE LINE # 52
0008 120000      R     LCALL   L?0270
                                           ; SOURCE LINE # 53
000B 22                RET     
             ; FUNCTION PECI_InitTimeOutTimer (END)

             ; FUNCTION _PECI_CalcCRC8 (BEGIN)
                                           ; SOURCE LINE # 58
0000 900000      R     MOV     DPTR,#sourcebyte
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 59
                                           ; SOURCE LINE # 89
0005 22                RET     
             ; FUNCTION _PECI_CalcCRC8 (END)

             ; FUNCTION PECI_HostEnable (BEGIN)
                                           ; SOURCE LINE # 94
                                           ; SOURCE LINE # 95
                                           ; SOURCE LINE # 96
0000 900000      E     MOV     DPTR,#HOCTLR
0003 E0                MOVX    A,@DPTR
0004 443C              ORL     A,#03CH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 97
0007 22                RET     
             ; FUNCTION PECI_HostEnable (END)

             ; FUNCTION PECI_HostDisable (BEGIN)
                                           ; SOURCE LINE # 102
                                           ; SOURCE LINE # 103
                                           ; SOURCE LINE # 104
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#HOCTLR
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 105
0005 22                RET     
             ; FUNCTION PECI_HostDisable (END)

             ; FUNCTION _PECI_HostControl (BEGIN)
                                           ; SOURCE LINE # 110
;---- Variable 'control' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 111
                                           ; SOURCE LINE # 112
0000 900000      E     MOV     DPTR,#HOCTLR
0003 E0                MOVX    A,@DPTR
0004 4F                ORL     A,R7
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 113
0006 22                RET     
             ; FUNCTION _PECI_HostControl (END)

             ; FUNCTION PECI_CheckHostBusy (BEGIN)
                                           ; SOURCE LINE # 121
                                           ; SOURCE LINE # 122
                                           ; SOURCE LINE # 123
0000 120000      R     LCALL   PECI_InitTimeOutTimer
0003         ?C0009:
                                           ; SOURCE LINE # 125
0003 208F0A            JB      TF1,?C0010
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 31  

                                           ; SOURCE LINE # 126
                                           ; SOURCE LINE # 127
0006 900000      E     MOV     DPTR,#HOSTAR
0009 E0                MOVX    A,@DPTR
000A 20E0F6            JB      ACC.0,?C0009
                                           ; SOURCE LINE # 128
                                           ; SOURCE LINE # 129
                                           ; SOURCE LINE # 130
                                           ; SOURCE LINE # 131
000D 120000      R     LCALL   L?0272
                                           ; SOURCE LINE # 132
                                           ; SOURCE LINE # 133
                                           ; SOURCE LINE # 134
0010         ?C0010:
                                           ; SOURCE LINE # 136
0010 308F06            JNB     TF1,?C0012
                                           ; SOURCE LINE # 137
                                           ; SOURCE LINE # 138
                                           ; SOURCE LINE # 139
                                           ; SOURCE LINE # 140
0013 120000      R     LCALL   L?0272
                                           ; SOURCE LINE # 141
0016 7F00              MOV     R7,#00H
0018 22                RET     
                                           ; SOURCE LINE # 142
0019         ?C0012:
                                           ; SOURCE LINE # 143
0019 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 144
001B         ?C0013:
001B 22                RET     
             ; FUNCTION PECI_CheckHostBusy (END)

             ; FUNCTION PECI_CheckHostFinish (BEGIN)
                                           ; SOURCE LINE # 152
;---- Variable 'status' assigned to Register 'R3' ----
;---- Variable 'result' assigned to Register 'R6' ----
                                           ; SOURCE LINE # 153
                                           ; SOURCE LINE # 156
;---- Variable 'error' assigned to Register 'R5' ----
0000 7D04              MOV     R5,#04H
                                           ; SOURCE LINE # 158
0002 120000      R     LCALL   PECI_InitTimeOutTimer
0005         ?C0014:
                                           ; SOURCE LINE # 159
0005 208F39            JB      TF1,?C0015
                                           ; SOURCE LINE # 160
                                           ; SOURCE LINE # 161
0008 900000      E     MOV     DPTR,#HOSTAR
000B E0                MOVX    A,@DPTR
000C FB                MOV     R3,A
                                           ; SOURCE LINE # 163
000D 60F6              JZ      ?C0014
                                           ; SOURCE LINE # 164
                                           ; SOURCE LINE # 165
000F 30E104            JNB     ACC.1,?C0017
                                           ; SOURCE LINE # 166
                                           ; SOURCE LINE # 167
0012 E4                CLR     A
0013 FD                MOV     R5,A
                                           ; SOURCE LINE # 168
0014 802B              SJMP    ?C0015
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 32  

                                           ; SOURCE LINE # 169
0016         ?C0017:
                                           ; SOURCE LINE # 170
0016 EB                MOV     A,R3
0017 30E204            JNB     ACC.2,?C0019
                                           ; SOURCE LINE # 171
                                           ; SOURCE LINE # 172
001A 7D01              MOV     R5,#01H
                                           ; SOURCE LINE # 173
001C 8023              SJMP    ?C0015
                                           ; SOURCE LINE # 174
001E         ?C0019:
                                           ; SOURCE LINE # 175
001E EB                MOV     A,R3
001F 30E304            JNB     ACC.3,?C0021
                                           ; SOURCE LINE # 176
                                           ; SOURCE LINE # 177
0022 7D01              MOV     R5,#01H
                                           ; SOURCE LINE # 178
0024 801B              SJMP    ?C0015
                                           ; SOURCE LINE # 179
0026         ?C0021:
                                           ; SOURCE LINE # 180
0026 EB                MOV     A,R3
0027 30E502            JNB     ACC.5,?C0023
                                           ; SOURCE LINE # 181
                                           ; SOURCE LINE # 182
                                           ; SOURCE LINE # 183
                                           ; SOURCE LINE # 184
002A 8004              SJMP    ?C0228
                                           ; SOURCE LINE # 185
002C         ?C0023:
                                           ; SOURCE LINE # 186
002C EB                MOV     A,R3
002D 30E60B            JNB     ACC.6,?C0025
                                           ; SOURCE LINE # 187
                                           ; SOURCE LINE # 188
0030         ?C0228:
0030 900000      E     MOV     DPTR,#RSTC4
0033 E0                MOVX    A,@DPTR
0034 4410              ORL     A,#010H
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 189
0037 7D02              MOV     R5,#02H
                                           ; SOURCE LINE # 190
0039 8006              SJMP    ?C0015
                                           ; SOURCE LINE # 191
003B         ?C0025:
                                           ; SOURCE LINE # 192
003B EB                MOV     A,R3
003C 30E7C6            JNB     ACC.7,?C0014
                                           ; SOURCE LINE # 193
                                           ; SOURCE LINE # 194
003F 7D03              MOV     R5,#03H
                                           ; SOURCE LINE # 195
                                           ; SOURCE LINE # 196
                                           ; SOURCE LINE # 197
                                           ; SOURCE LINE # 198
0041         ?C0015:
                                           ; SOURCE LINE # 200
0041 ED                MOV     A,R5
0042 6004              JZ      ?C0028
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 33  

                                           ; SOURCE LINE # 201
                                           ; SOURCE LINE # 202
0044 E4                CLR     A
0045 FE                MOV     R6,A
                                           ; SOURCE LINE # 203
0046 8002              SJMP    ?C0029
0048         ?C0028:
                                           ; SOURCE LINE # 205
                                           ; SOURCE LINE # 206
0048 7E01              MOV     R6,#01H
                                           ; SOURCE LINE # 207
004A         ?C0029:
                                           ; SOURCE LINE # 209
                                           ; SOURCE LINE # 210
                                           ; SOURCE LINE # 211
004A 120000      R     LCALL   L?0273
                                           ; SOURCE LINE # 212
004D CF                XCH     A,R7
004E EE                MOV     A,R6
004F CF                XCH     A,R7
                                           ; SOURCE LINE # 213
0050         ?C0030:
0050 22                RET     
             ; FUNCTION PECI_CheckHostFinish (END)

             ; FUNCTION ResetPECIStatus (BEGIN)
                                           ; SOURCE LINE # 218
                                           ; SOURCE LINE # 219
                                           ; SOURCE LINE # 220
0000 900000      E     MOV     DPTR,#HOSTAR
0003 74FE              MOV     A,#0FEH
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 221
0006 22                RET     
             ; FUNCTION ResetPECIStatus (END)

             ; FUNCTION _PECI_Ping (BEGIN)
                                           ; SOURCE LINE # 233
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'WriteLen' assigned to Register 'R3' ----
;---- Variable 'ReadLen' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 234
                                           ; SOURCE LINE # 236
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 238
                                           ; SOURCE LINE # 239
0000 120000      R     LCALL   L?0249
                                           ; SOURCE LINE # 240
0003 900000      E     MOV     DPTR,#HOWRLR
0006 EB                MOV     A,R3
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 241
0008 900000      E     MOV     DPTR,#HORDLR
000B ED                MOV     A,R5
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 243
000D 120000      R     LCALL   PECI_CheckHostBusy
0010 EF                MOV     A,R7
0011 6006              JZ      ?C0032
                                           ; SOURCE LINE # 244
                                           ; SOURCE LINE # 245
                                           ; SOURCE LINE # 246
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 34  

0013 120000      R     LCALL   L?0250
0016 6001              JZ      ?C0032
                                           ; SOURCE LINE # 247
                                           ; SOURCE LINE # 248
0018 0C                INC     R4
                                           ; SOURCE LINE # 249
                                           ; SOURCE LINE # 250
0019         ?C0032:
                                           ; SOURCE LINE # 252
                                           ; SOURCE LINE # 253
                                           ; SOURCE LINE # 254
0019 120000      R     LCALL   L?0258
                                           ; SOURCE LINE # 255
001C         ?C0034:
001C 22                RET     
             ; FUNCTION _PECI_Ping (END)

             ; FUNCTION _PECI_GetDIB (BEGIN)
                                           ; SOURCE LINE # 268
0000 900000      R     MOV     DPTR,#ReadData
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'ReadLen' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 269
                                           ; SOURCE LINE # 271
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 273
                                           ; SOURCE LINE # 274
0003 120000      R     LCALL   L?0247
                                           ; SOURCE LINE # 275
0006 900000      R     MOV     DPTR,#WriteLen
0009 E0                MOVX    A,@DPTR
000A 900000      E     MOV     DPTR,#HOWRLR
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 276
000E 900000      E     MOV     DPTR,#HORDLR
0011 EB                MOV     A,R3
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 277
0013 900000      E     MOV     DPTR,#HOCMDR
0016 74F7              MOV     A,#0F7H
0018 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 279
0019 120000      R     LCALL   PECI_CheckHostBusy
001C EF                MOV     A,R7
001D 6026              JZ      ?C0035
                                           ; SOURCE LINE # 280
                                           ; SOURCE LINE # 281
                                           ; SOURCE LINE # 282
001F 120000      R     LCALL   L?0250
0022 6021              JZ      ?C0035
                                           ; SOURCE LINE # 283
                                           ; SOURCE LINE # 284
;---- Variable 'index' assigned to Register 'R7' ----
0024 E4                CLR     A
0025 FF                MOV     R7,A
0026         ?C0037:
0026 120000      R     LCALL   L?0277
0029 5018              JNC     ?C0038
                                           ; SOURCE LINE # 285
                                           ; SOURCE LINE # 286
002B 900000      E     MOV     DPTR,#HORDDR
002E E0                MOVX    A,@DPTR
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 35  

002F FE                MOV     R6,A
0030 900000      R     MOV     DPTR,#ReadData
0033 E0                MOVX    A,@DPTR
0034 FA                MOV     R2,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 2F                ADD     A,R7
0038 F582              MOV     DPL,A
003A E4                CLR     A
003B 3A                ADDC    A,R2
003C F583              MOV     DPH,A
003E EE                MOV     A,R6
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 287
0040 0F                INC     R7
0041 80E3              SJMP    ?C0037
0043         ?C0038:
                                           ; SOURCE LINE # 288
0043 7C01              MOV     R4,#01H
                                           ; SOURCE LINE # 289
                                           ; SOURCE LINE # 290
0045         ?C0035:
                                           ; SOURCE LINE # 292
                                           ; SOURCE LINE # 293
                                           ; SOURCE LINE # 294
0045 120000      R     LCALL   L?0258
                                           ; SOURCE LINE # 295
0048         ?C0040:
0048 22                RET     
             ; FUNCTION _PECI_GetDIB (END)

             ; FUNCTION _PECI_GetTemp (BEGIN)
                                           ; SOURCE LINE # 310
0000 900000      R     MOV     DPTR,#ReadData
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'Domain' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 311
                                           ; SOURCE LINE # 313
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 315
                                           ; SOURCE LINE # 316
0003 120000      R     LCALL   L?0247
                                           ; SOURCE LINE # 317
0006 900000      R     MOV     DPTR,#WriteLen
0009 E0                MOVX    A,@DPTR
000A 900000      E     MOV     DPTR,#HOWRLR
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 318
000E 900000      R     MOV     DPTR,#ReadLen
                                           ; SOURCE LINE # 319
0011 120000      R     LCALL   L?0274
0014 5008              JNC     ?C0041
                                           ; SOURCE LINE # 320
                                           ; SOURCE LINE # 321
0016 EB                MOV     A,R3
0017 04                INC     A
0018 900000      E     MOV     DPTR,#HOCMDR
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 322
001C 8006              SJMP    ?C0042
001E         ?C0041:
                                           ; SOURCE LINE # 324
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 36  

                                           ; SOURCE LINE # 325
001E 900000      E     MOV     DPTR,#HOCMDR
0021 7401              MOV     A,#01H
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 326
0024         ?C0042:
                                           ; SOURCE LINE # 328
0024 120000      R     LCALL   PECI_CheckHostBusy
0027 EF                MOV     A,R7
0028 602F              JZ      ?C0043
                                           ; SOURCE LINE # 329
                                           ; SOURCE LINE # 330
                                           ; SOURCE LINE # 331
002A 120000      R     LCALL   L?0251
002D 602A              JZ      ?C0043
                                           ; SOURCE LINE # 332
                                           ; SOURCE LINE # 333
002F 900000      E     MOV     DPTR,#HORDDR
0032 E0                MOVX    A,@DPTR
0033 FF                MOV     R7,A
0034 900000      R     MOV     DPTR,#ReadData
0037 E0                MOVX    A,@DPTR
0038 FC                MOV     R4,A
0039 A3                INC     DPTR
003A E0                MOVX    A,@DPTR
003B F582              MOV     DPL,A
003D 8C83              MOV     DPH,R4
003F EF                MOV     A,R7
0040 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 334
0041 900000      E     MOV     DPTR,#HORDDR
0044 E0                MOVX    A,@DPTR
0045 FF                MOV     R7,A
0046 900000      R     MOV     DPTR,#ReadData
0049 E4                CLR     A
004A 75F001            MOV     B,#01H
004D 120000      E     LCALL   ?C?IILDX
0050 85F082            MOV     DPL,B
0053 F583              MOV     DPH,A
0055 EF                MOV     A,R7
0056 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 335
0057 7C01              MOV     R4,#01H
                                           ; SOURCE LINE # 336
                                           ; SOURCE LINE # 337
0059         ?C0043:
                                           ; SOURCE LINE # 339
                                           ; SOURCE LINE # 340
                                           ; SOURCE LINE # 341
0059 120000      R     LCALL   L?0259
                                           ; SOURCE LINE # 342
005C         ?C0045:
005C 22                RET     
             ; FUNCTION _PECI_GetTemp (END)

             ; FUNCTION _PECI_RdPkgConfig (BEGIN)
                                           ; SOURCE LINE # 361
0000 900000      R     MOV     DPTR,#ReadData
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'Domain' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 362
                                           ; SOURCE LINE # 364
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 37  

;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 366
                                           ; SOURCE LINE # 367
0003 120000      R     LCALL   L?0248
                                           ; SOURCE LINE # 368
0006 900000      R     MOV     DPTR,#WriteLen
0009 E0                MOVX    A,@DPTR
000A 900000      E     MOV     DPTR,#HOWRLR
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 369
000E 900000      R     MOV     DPTR,#ReadLen
                                           ; SOURCE LINE # 370
0011 120000      R     LCALL   L?0274
0014 5009              JNC     ?C0046
                                           ; SOURCE LINE # 371
                                           ; SOURCE LINE # 372
0016 EB                MOV     A,R3
0017 24A1              ADD     A,#0A1H
0019 900000      E     MOV     DPTR,#HOCMDR
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 373
001D 8006              SJMP    ?C0047
001F         ?C0046:
                                           ; SOURCE LINE # 375
                                           ; SOURCE LINE # 376
001F 900000      E     MOV     DPTR,#HOCMDR
0022 74A1              MOV     A,#0A1H
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 377
0025         ?C0047:
                                           ; SOURCE LINE # 379
0025 900000      R     MOV     DPTR,#Retry
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
002A C3                CLR     C
002B 9402              SUBB    A,#02H
002D 5009              JNC     ?C0048
                                           ; SOURCE LINE # 380
                                           ; SOURCE LINE # 381
002F EF                MOV     A,R7
0030 2402              ADD     A,#02H
0032 900000      E     MOV     DPTR,#HOWRDR
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 382
0036 8003              SJMP    ?C0049
0038         ?C0048:
                                           ; SOURCE LINE # 384
                                           ; SOURCE LINE # 385
0038 120000      R     LCALL   L?0282
                                           ; SOURCE LINE # 386
003B         ?C0049:
                                           ; SOURCE LINE # 388
003B 900000      R     MOV     DPTR,#Index
003E E0                MOVX    A,@DPTR
003F 900000      E     MOV     DPTR,#HOWRDR
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 389
0043 900000      R     MOV     DPTR,#LSB
0046 E0                MOVX    A,@DPTR
0047 900000      E     MOV     DPTR,#HOWRDR
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 390
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 38  

004B 900000      R     MOV     DPTR,#MSB
                                           ; SOURCE LINE # 392
004E 120000      R     LCALL   L?0284
0051 603A              JZ      ?C0050
                                           ; SOURCE LINE # 393
                                           ; SOURCE LINE # 394
                                           ; SOURCE LINE # 395
0053 120000      R     LCALL   L?0251
0056 6035              JZ      ?C0050
                                           ; SOURCE LINE # 396
                                           ; SOURCE LINE # 397
0058 900000      E     MOV     DPTR,#HORDLR
005B E0                MOVX    A,@DPTR
005C 602D              JZ      ?C0052
                                           ; SOURCE LINE # 398
                                           ; SOURCE LINE # 399
;---- Variable 'cunt' assigned to Register 'R7' ----
005E E4                CLR     A
005F FF                MOV     R7,A
0060         ?C0053:
0060 120000      R     LCALL   L?0277
0063 5017              JNC     ?C0054
                                           ; SOURCE LINE # 400
                                           ; SOURCE LINE # 401
0065 EF                MOV     A,R7
0066 900000      E     MOV     DPTR,#HORDDR
0069 7007              JNZ     ?C0056
                                           ; SOURCE LINE # 402
                                           ; SOURCE LINE # 403
006B E0                MOVX    A,@DPTR
006C 900000      E     MOV     DPTR,#PECI_CompletionCode
006F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 404
0070 8007              SJMP    ?C0055
0072         ?C0056:
                                           ; SOURCE LINE # 406
                                           ; SOURCE LINE # 407
0072 E0                MOVX    A,@DPTR
0073 900000      R     MOV     DPTR,#ReadData
0076 120000      R     LCALL   L?0260
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 409
0079         ?C0055:
0079 0F                INC     R7
007A 80E4              SJMP    ?C0053
007C         ?C0054:
                                           ; SOURCE LINE # 411
007C 900000      E     MOV     DPTR,#PECI_CompletionCode
007F E0                MOVX    A,@DPTR
0080 B44004            CJNE    A,#040H,?C0058
                                           ; SOURCE LINE # 412
                                           ; SOURCE LINE # 413
0083 7C01              MOV     R4,#01H
                                           ; SOURCE LINE # 414
0085 8006              SJMP    ?C0050
0087         ?C0058:
                                           ; SOURCE LINE # 416
                                           ; SOURCE LINE # 417
0087 E4                CLR     A
0088 FC                MOV     R4,A
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 419
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 39  

0089 8002              SJMP    ?C0050
008B         ?C0052:
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
008B E4                CLR     A
008C FC                MOV     R4,A
                                           ; SOURCE LINE # 423
                                           ; SOURCE LINE # 424
                                           ; SOURCE LINE # 425
008D         ?C0050:
                                           ; SOURCE LINE # 427
                                           ; SOURCE LINE # 428
                                           ; SOURCE LINE # 429
008D 120000      R     LCALL   L?0259
                                           ; SOURCE LINE # 430
0090         ?C0061:
0090 22                RET     
             ; FUNCTION _PECI_RdPkgConfig (END)

             ; FUNCTION _PECI_WrPkgConfig (BEGIN)
                                           ; SOURCE LINE # 449
;---- Variable 'addr' assigned to Register 'R6' ----
0000 CE                XCH     A,R6
0001 EF                MOV     A,R7
0002 CE                XCH     A,R6
;---- Variable 'Domain' assigned to Register 'R3' ----
;---- Variable 'WriteData' assigned to Register 'R4/R5' ----
                                           ; SOURCE LINE # 450
                                           ; SOURCE LINE # 452
;---- Variable 'done' assigned to Register 'R2' ----
0003 E4                CLR     A
0004 FA                MOV     R2,A
                                           ; SOURCE LINE # 454
0005 900000      E     MOV     DPTR,#PECI_CompletionCode
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 455
0009 120000      R     LCALL   PECI_HostEnable
                                           ; SOURCE LINE # 460
000C 7F02              MOV     R7,#02H
000E 120000      R     LCALL   _PECI_HostControl
                                           ; SOURCE LINE # 463
0011 900000      E     MOV     DPTR,#HOTRADDR
0014 EE                MOV     A,R6
0015 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 464
0016 FF                MOV     R7,A
0017 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 465
001A 900000      R     MOV     DPTR,#WriteLen
001D E0                MOVX    A,@DPTR
001E FF                MOV     R7,A
001F 900000      E     MOV     DPTR,#HOWRLR
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 466
0023 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 467
0026 900000      R     MOV     DPTR,#ReadLen
0029 E0                MOVX    A,@DPTR
002A FF                MOV     R7,A
002B 900000      E     MOV     DPTR,#HORDLR
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 468
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 40  

002F 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 470
0032 EB                MOV     A,R3
0033 C3                CLR     C
0034 9402              SUBB    A,#02H
0036 500A              JNC     ?C0062
                                           ; SOURCE LINE # 471
                                           ; SOURCE LINE # 472
0038 EB                MOV     A,R3
0039 24A5              ADD     A,#0A5H
003B FF                MOV     R7,A
003C 900000      E     MOV     DPTR,#HOCMDR
003F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 473
                                           ; SOURCE LINE # 474
0040 8007              SJMP    ?C0229
0042         ?C0062:
                                           ; SOURCE LINE # 476
                                           ; SOURCE LINE # 477
0042 900000      E     MOV     DPTR,#HOCMDR
0045 74A5              MOV     A,#0A5H
0047 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 478
0048 FF                MOV     R7,A
0049         ?C0229:
0049 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 479
004C         ?C0063:
                                           ; SOURCE LINE # 481
004C 900000      R     MOV     DPTR,#Retry
004F E0                MOVX    A,@DPTR
0050 FF                MOV     R7,A
0051 C3                CLR     C
0052 9402              SUBB    A,#02H
0054 500A              JNC     ?C0064
                                           ; SOURCE LINE # 482
                                           ; SOURCE LINE # 483
0056 EF                MOV     A,R7
0057 2402              ADD     A,#02H
0059 FF                MOV     R7,A
005A 900000      E     MOV     DPTR,#HOWRDR
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 484
                                           ; SOURCE LINE # 485
005E 8004              SJMP    ?C0230
0060         ?C0064:
                                           ; SOURCE LINE # 487
                                           ; SOURCE LINE # 488
0060 120000      R     LCALL   L?0282
                                           ; SOURCE LINE # 489
0063 FF                MOV     R7,A
0064         ?C0230:
0064 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 490
0067         ?C0065:
                                           ; SOURCE LINE # 492
0067 900000      R     MOV     DPTR,#Index
                                           ; SOURCE LINE # 493
006A 120000      R     LCALL   L?0276
                                           ; SOURCE LINE # 494
006D 900000      R     MOV     DPTR,#LSB
                                           ; SOURCE LINE # 495
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 41  

0070 120000      R     LCALL   L?0276
                                           ; SOURCE LINE # 496
0073 900000      R     MOV     DPTR,#MSB
0076 E0                MOVX    A,@DPTR
0077 FF                MOV     R7,A
0078 900000      E     MOV     DPTR,#HOWRDR
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 497
007C 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 499
;---- Variable 'cunt' assigned to Register 'R6' ----
007F E4                CLR     A
0080 FE                MOV     R6,A
0081         ?C0066:
0081 900000      R     MOV     DPTR,#WriteLen
0084 E0                MOVX    A,@DPTR
0085 24FA              ADD     A,#0FAH
0087 FF                MOV     R7,A
0088 EE                MOV     A,R6
0089 C3                CLR     C
008A 9F                SUBB    A,R7
008B 5011              JNC     ?C0067
                                           ; SOURCE LINE # 500
                                           ; SOURCE LINE # 501
008D 120000      R     LCALL   L?0285
0090 900000      E     MOV     DPTR,#HOWRDR
0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 502
0094 120000      R     LCALL   L?0285
0097 FF                MOV     R7,A
0098 120000      R     LCALL   _PECI_CalcCRC8
                                           ; SOURCE LINE # 503
009B 0E                INC     R6
009C 80E3              SJMP    ?C0066
009E         ?C0067:
                                           ; SOURCE LINE # 510
009E 120000      R     LCALL   PECI_CheckHostBusy
00A1 EF                MOV     A,R7
00A2 6017              JZ      ?C0069
                                           ; SOURCE LINE # 511
                                           ; SOURCE LINE # 512
                                           ; SOURCE LINE # 513
00A4 120000      R     LCALL   L?0251
00A7 6012              JZ      ?C0069
                                           ; SOURCE LINE # 514
                                           ; SOURCE LINE # 515
00A9 900000      E     MOV     DPTR,#HORDDR
00AC E0                MOVX    A,@DPTR
00AD 900000      E     MOV     DPTR,#PECI_CompletionCode
00B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 516
00B1 E0                MOVX    A,@DPTR
00B2 B44004            CJNE    A,#040H,?C0071
                                           ; SOURCE LINE # 517
                                           ; SOURCE LINE # 518
00B5 7A01              MOV     R2,#01H
                                           ; SOURCE LINE # 519
00B7 8002              SJMP    ?C0069
00B9         ?C0071:
                                           ; SOURCE LINE # 521
                                           ; SOURCE LINE # 522
00B9 E4                CLR     A
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 42  

00BA FA                MOV     R2,A
                                           ; SOURCE LINE # 523
                                           ; SOURCE LINE # 524
                                           ; SOURCE LINE # 525
00BB         ?C0069:
                                           ; SOURCE LINE # 527
00BB 120000      R     LCALL   PECI_HostDisable
                                           ; SOURCE LINE # 528
00BE 120000      R     LCALL   ResetPECIStatus
                                           ; SOURCE LINE # 529
00C1 CF                XCH     A,R7
00C2 EA                MOV     A,R2
00C3 CF                XCH     A,R7
                                           ; SOURCE LINE # 530
00C4         ?C0073:
00C4 22                RET     
00C5         L?0276:
00C5 E0                MOVX    A,@DPTR
00C6 FF                MOV     R7,A
00C7 900000      E     MOV     DPTR,#HOWRDR
00CA F0                MOVX    @DPTR,A
00CB 120000      R     LCALL   _PECI_CalcCRC8
00CE 22                RET     
             ; FUNCTION _PECI_WrPkgConfig (END)

             ; FUNCTION _PECI_RdIAMSR (BEGIN)
                                           ; SOURCE LINE # 549
0000 900000      R     MOV     DPTR,#ReadData
;---- Variable 'addr' assigned to Register 'R7' ----
;---- Variable 'Domain' assigned to Register 'R3' ----
                                           ; SOURCE LINE # 550
                                           ; SOURCE LINE # 552
;---- Variable 'done' assigned to Register 'R4' ----
                                           ; SOURCE LINE # 554
                                           ; SOURCE LINE # 555
0003 120000      R     LCALL   L?0248
                                           ; SOURCE LINE # 556
0006 900000      R     MOV     DPTR,#WriteLen
0009 E0                MOVX    A,@DPTR
000A 900000      E     MOV     DPTR,#HOWRLR
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 557
000E 900000      R     MOV     DPTR,#ReadLen
                                           ; SOURCE LINE # 558
0011 120000      R     LCALL   L?0275
0014 5009              JNC     ?C0074
                                           ; SOURCE LINE # 559
                                           ; SOURCE LINE # 560
0016 EB                MOV     A,R3
0017 24B1              ADD     A,#0B1H
0019 900000      E     MOV     DPTR,#HOCMDR
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 561
001D 8006              SJMP    ?C0075
001F         ?C0074:
                                           ; SOURCE LINE # 563
                                           ; SOURCE LINE # 564
001F 900000      E     MOV     DPTR,#HOCMDR
0022 74B1              MOV     A,#0B1H
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 565
0025         ?C0075:
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 43  

                                           ; SOURCE LINE # 567
0025 900000      R     MOV     DPTR,#Retry
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
002A C3                CLR     C
002B 9402              SUBB    A,#02H
002D 5009              JNC     ?C0076
                                           ; SOURCE LINE # 568
                                           ; SOURCE LINE # 569
002F EF                MOV     A,R7
0030 2402              ADD     A,#02H
0032 900000      E     MOV     DPTR,#HOWRDR
0035 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 570
0036 8003              SJMP    ?C0077
0038         ?C0076:
                                           ; SOURCE LINE # 572
                                           ; SOURCE LINE # 573
0038 120000      R     LCALL   L?0283
                                           ; SOURCE LINE # 574
003B         ?C0077:
                                           ; SOURCE LINE # 576
003B 900000      R     MOV     DPTR,#ProcessorID
003E E0                MOVX    A,@DPTR
003F 900000      E     MOV     DPTR,#HOWRDR
0042 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 577
0043 900000      R     MOV     DPTR,#LSB
0046 E0                MOVX    A,@DPTR
0047 900000      E     MOV     DPTR,#HOWRDR
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 578
004B 900000      R     MOV     DPTR,#MSB
                                           ; SOURCE LINE # 580
004E 120000      R     LCALL   L?0284
0051 6030              JZ      ?C0078
                                           ; SOURCE LINE # 581
                                           ; SOURCE LINE # 582
                                           ; SOURCE LINE # 583
0053 120000      R     LCALL   L?0251
0056 602B              JZ      ?C0078
                                           ; SOURCE LINE # 584
                                           ; SOURCE LINE # 585
;---- Variable 'cunt' assigned to Register 'R7' ----
0058 E4                CLR     A
0059 FF                MOV     R7,A
005A         ?C0080:
005A 120000      R     LCALL   L?0278
005D 5017              JNC     ?C0081
                                           ; SOURCE LINE # 586
                                           ; SOURCE LINE # 587
005F EF                MOV     A,R7
0060 900000      E     MOV     DPTR,#HORDDR
0063 7007              JNZ     ?C0083
                                           ; SOURCE LINE # 588
                                           ; SOURCE LINE # 589
0065 E0                MOVX    A,@DPTR
0066 900000      E     MOV     DPTR,#PECI_CompletionCode
0069 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 590
006A 8007              SJMP    ?C0082
006C         ?C0083:
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 44  

                                           ; SOURCE LINE # 592
                                           ; SOURCE LINE # 593
006C E0                MOVX    A,@DPTR
006D 900000      R     MOV     DPTR,#ReadData
0070 120000      R     LCALL   L?0260
                                           ; SOURCE LINE # 594
                                           ; SOURCE LINE # 595
0073         ?C0082:
0073 0F                INC     R7
0074 80E4              SJMP    ?C0080
0076         ?C0081:
                                           ; SOURCE LINE # 597
0076 900000      E     MOV     DPTR,#PECI_CompletionCode
0079 E0                MOVX    A,@DPTR
007A B44004            CJNE    A,#040H,?C0085
                                           ; SOURCE LINE # 598
                                           ; SOURCE LINE # 599
007D 7C01              MOV     R4,#01H
                                           ; SOURCE LINE # 600
007F 8002              SJMP    ?C0078
0081         ?C0085:
                                           ; SOURCE LINE # 602
                                           ; SOURCE LINE # 603
0081 E4                CLR     A
0082 FC                MOV     R4,A
                                           ; SOURCE LINE # 604
                                           ; SOURCE LINE # 605
                                           ; SOURCE LINE # 606
0083         ?C0078:
                                           ; SOURCE LINE # 608
                                           ; SOURCE LINE # 609
                                           ; SOURCE LINE # 610
0083 120000      R     LCALL   L?0259
                                           ; SOURCE LINE # 611
0086         ?C0087:
0086 22                RET     
             ; FUNCTION _PECI_RdIAMSR (END)

             ; FUNCTION PECI_ClearTCVariables (BEGIN)
                                           ; SOURCE LINE # 616
                                           ; SOURCE LINE # 617
                                           ; SOURCE LINE # 618
0000 120000      R     LCALL   PECI_ClearPowerSKUUnit
                                           ; SOURCE LINE # 619
0003 E4                CLR     A
0004 900000      E     MOV     DPTR,#PECI_PL1TDP
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 620
0008 900000      E     MOV     DPTR,#PECI_MAXPL2
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 621
000C 900000      E     MOV     DPTR,#PECI_PL2Watts
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 622
0010 900000      E     MOV     DPTR,#PECI_PL1Time
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 623
0014 900000      E     MOV     DPTR,#PECI_Ctrl
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 624
0018 900000      E     MOV     DPTR,#PECI_Algorithm_Delay
001B F0                MOVX    @DPTR,A
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 45  

                                           ; SOURCE LINE # 625
001C 22                RET     
             ; FUNCTION PECI_ClearTCVariables (END)

             ; FUNCTION PECI_ClearPowerSKUUnit (BEGIN)
                                           ; SOURCE LINE # 630
                                           ; SOURCE LINE # 631
                                           ; SOURCE LINE # 632
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#PECI_PowerUnit
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 633
0005 900000      E     MOV     DPTR,#PECI_EnergyUnit
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 634
0009 900000      E     MOV     DPTR,#PECI_TimeUnit
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 635
000D 22                RET     
             ; FUNCTION PECI_ClearPowerSKUUnit (END)

             ; FUNCTION PECI_ReadPowerUnit (BEGIN)
                                           ; SOURCE LINE # 643
;---- Variable 'result' assigned to Register 'R1' ----
                                           ; SOURCE LINE # 644
                                           ; SOURCE LINE # 646
0000 120000      R     LCALL   L?0252
0003 741E              MOV     A,#01EH
0005 120000      R     LCALL   L?0241
0008 120000      R     LCALL   _PECI_RdPkgConfig
000B EF                MOV     A,R7
000C 6022              JZ      ?C0090
                                           ; SOURCE LINE # 647
                                           ; SOURCE LINE # 648
000E 900000      E     MOV     DPTR,#PECIReadBuffer
0011 E0                MOVX    A,@DPTR
0012 540F              ANL     A,#0FH
0014 900000      E     MOV     DPTR,#PECI_PowerUnit
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 649
0018 900000      E     MOV     DPTR,#PECIReadBuffer+01H
001B E0                MOVX    A,@DPTR
001C 541F              ANL     A,#01FH
001E 900000      E     MOV     DPTR,#PECI_EnergyUnit
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 650
0022 900000      E     MOV     DPTR,#PECIReadBuffer+02H
0025 E0                MOVX    A,@DPTR
0026 540F              ANL     A,#0FH
0028 900000      E     MOV     DPTR,#PECI_TimeUnit
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 651
002C 7901              MOV     R1,#01H
                                           ; SOURCE LINE # 652
002E 8002              SJMP    ?C0091
0030         ?C0090:
                                           ; SOURCE LINE # 654
                                           ; SOURCE LINE # 655
0030 E4                CLR     A
0031 F9                MOV     R1,A
                                           ; SOURCE LINE # 656
0032         ?C0091:
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 46  

                                           ; SOURCE LINE # 657
0032 CF                XCH     A,R7
0033 E9                MOV     A,R1
0034 CF                XCH     A,R7
                                           ; SOURCE LINE # 658
0035         ?C0092:
0035 22                RET     
             ; FUNCTION PECI_ReadPowerUnit (END)

             ; FUNCTION PECI_WritePowerLimit1 (BEGIN)
                                           ; SOURCE LINE # 666
;---- Variable 'reslut' assigned to Register 'R1' ----
                                           ; SOURCE LINE # 667
                                           ; SOURCE LINE # 674
0000 120000      R     LCALL   L?0255
0003 8005              SJMP    ?C0213
0005         ?C0212:
0005 C3                CLR     C
0006 33                RLC     A
0007 CE                XCH     A,R6
0008 33                RLC     A
0009 CE                XCH     A,R6
000A         ?C0213:
000A D8F9              DJNZ    R0,?C0212
000C 900000      R     MOV     DPTR,#UnitofPower+01H
000F F0                MOVX    @DPTR,A
0010 EE                MOV     A,R6
0011 900000      R     MOV     DPTR,#UnitofPower
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 675
0015 900000      E     MOV     DPTR,#PECI_PL1TDP
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A 7E00              MOV     R6,#00H
001C 900000      R     MOV     DPTR,#UnitofPower
001F E0                MOVX    A,@DPTR
0020 FC                MOV     R4,A
0021 A3                INC     DPTR
0022 E0                MOVX    A,@DPTR
0023 FD                MOV     R5,A
0024 120000      E     LCALL   ?C?IMUL
0027 900000      R     MOV     DPTR,#PL1_TDPWatts
002A EE                MOV     A,R6
002B F0                MOVX    @DPTR,A
002C A3                INC     DPTR
002D EF                MOV     A,R7
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 677
002F 900000      E     MOV     DPTR,#PECI_TimeUnit
0032 120000      R     LCALL   L?0257
0035 8005              SJMP    ?C0215
0037         ?C0214:
0037 C3                CLR     C
0038 33                RLC     A
0039 CE                XCH     A,R6
003A 33                RLC     A
003B CE                XCH     A,R6
003C         ?C0215:
003C D8F9              DJNZ    R0,?C0214
003E 900000      R     MOV     DPTR,#UnitofTau+01H
0041 F0                MOVX    @DPTR,A
0042 EE                MOV     A,R6
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 47  

0043 900000      R     MOV     DPTR,#UnitofTau
0046 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 679
;---- Variable 'PL1_PL1T' assigned to Register 'R5' ----
                                           ; SOURCE LINE # 681
0047 900000      R     MOV     DPTR,#PL1_TDPWatts
004A E0                MOVX    A,@DPTR
004B A3                INC     DPTR
004C E0                MOVX    A,@DPTR
004D 900000      E     MOV     DPTR,#PECIWriteBuffer
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 682
0051 900000      R     MOV     DPTR,#PL1_TDPWatts
0054 E0                MOVX    A,@DPTR
0055 900000      E     MOV     DPTR,#PECIWriteBuffer+01H
0058 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 683
0059 A3                INC     DPTR
005A 74DC              MOV     A,#0DCH
005C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 684
005D E4                CLR     A
                                           ; SOURCE LINE # 686
005E 120000      R     LCALL   L?0281
0061 741A              MOV     A,#01AH
0063 120000      R     LCALL   L?0263
0066 120000      R     LCALL   _PECI_WrPkgConfig
0069 EF                MOV     A,R7
006A 6004              JZ      ?C0093
                                           ; SOURCE LINE # 687
                                           ; SOURCE LINE # 688
006C 7901              MOV     R1,#01H
                                           ; SOURCE LINE # 689
006E 8002              SJMP    ?C0094
0070         ?C0093:
                                           ; SOURCE LINE # 691
                                           ; SOURCE LINE # 692
0070 E4                CLR     A
0071 F9                MOV     R1,A
                                           ; SOURCE LINE # 693
0072         ?C0094:
                                           ; SOURCE LINE # 694
0072 CF                XCH     A,R7
0073 E9                MOV     A,R1
0074 CF                XCH     A,R7
                                           ; SOURCE LINE # 695
0075         ?C0095:
0075 22                RET     
             ; FUNCTION PECI_WritePowerLimit1 (END)

             ; FUNCTION PECI_ReadPowerLimit1 (BEGIN)
                                           ; SOURCE LINE # 704
                                           ; SOURCE LINE # 705
                                           ; SOURCE LINE # 708
0000 120000      R     LCALL   L?0252
0003 741A              MOV     A,#01AH
0005 120000      R     LCALL   L?0241
0008 120000      R     LCALL   _PECI_RdPkgConfig
000B EF                MOV     A,R7
000C 603E              JZ      ?C0096
                                           ; SOURCE LINE # 709
                                           ; SOURCE LINE # 710
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 48  

000E 900000      E     MOV     DPTR,#PECIReadBuffer+01H
0011 E0                MOVX    A,@DPTR
0012 547F              ANL     A,#07FH
0014 F0                MOVX    @DPTR,A
0015 120000      R     LCALL   L?0269
0018 FB                MOV     R3,A
0019 EC                MOV     A,R4
001A 3E                ADDC    A,R6
001B FA                MOV     R2,A
001C 120000      R     LCALL   L?0255
001F 8005              SJMP    ?C0217
0021         ?C0216:
0021 C3                CLR     C
0022 33                RLC     A
0023 CE                XCH     A,R6
0024 33                RLC     A
0025 CE                XCH     A,R6
0026         ?C0217:
0026 D8F9              DJNZ    R0,?C0216
0028 FD                MOV     R5,A
0029 CC                XCH     A,R4
002A EE                MOV     A,R6
002B CC                XCH     A,R4
002C CF                XCH     A,R7
002D EB                MOV     A,R3
002E CF                XCH     A,R7
002F CE                XCH     A,R6
0030 EA                MOV     A,R2
0031 CE                XCH     A,R6
0032 120000      E     LCALL   ?C?UIDIV
0035 900000      E     MOV     DPTR,#PECI_PL1TDP
0038 EF                MOV     A,R7
0039 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 711
003A 900000      E     MOV     DPTR,#PECIReadBuffer+02H
003D E0                MOVX    A,@DPTR
003E C3                CLR     C
003F 13                RRC     A
0040 900000      E     MOV     DPTR,#PECI_PL1Time
0043 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 712
0044 900000      R     MOV     DPTR,#reslut
0047 7401              MOV     A,#01H
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 713
004A 8005              SJMP    ?C0097
004C         ?C0096:
                                           ; SOURCE LINE # 715
                                           ; SOURCE LINE # 716
004C E4                CLR     A
004D 900000      R     MOV     DPTR,#reslut
0050 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 717
0051         ?C0097:
                                           ; SOURCE LINE # 718
0051 900000      R     MOV     DPTR,#reslut
0054 E0                MOVX    A,@DPTR
0055 FF                MOV     R7,A
                                           ; SOURCE LINE # 719
0056         ?C0098:
0056 22                RET     
             ; FUNCTION PECI_ReadPowerLimit1 (END)
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 49  


             ; FUNCTION PECI_ACToDCModeTurboCtrl (BEGIN)
                                           ; SOURCE LINE # 724
                                           ; SOURCE LINE # 725
                                           ; SOURCE LINE # 728
0000 900000      E     MOV     DPTR,#GPDRE
0003 E0                MOVX    A,@DPTR
0004 547F              ANL     A,#07FH
0006 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 729
0007 E4                CLR     A
0008 900000      R     MOV     DPTR,#retry
000B F0                MOVX    @DPTR,A
000C         ?C0099:
                                           ; SOURCE LINE # 730
                                           ; SOURCE LINE # 731
000C 900000      E     MOV     DPTR,#PECI_PL1TDP
000F E0                MOVX    A,@DPTR
0010 FF                MOV     R7,A
0011 120000      R     LCALL   _PECI_SETPL2Watts
                                           ; SOURCE LINE # 732
0014 900000      E     MOV     DPTR,#PECI_Ctrl
0017 E0                MOVX    A,@DPTR
0018 30E00C            JNB     ACC.0,?C0100
                                           ; SOURCE LINE # 733
                                           ; SOURCE LINE # 734
                                           ; SOURCE LINE # 735
001B         ?C0102:
                                           ; SOURCE LINE # 736
001B         ?C0101:
001B 900000      R     MOV     DPTR,#retry
001E E0                MOVX    A,@DPTR
001F 04                INC     A
0020 F0                MOVX    @DPTR,A
0021 E0                MOVX    A,@DPTR
0022 C3                CLR     C
0023 9405              SUBB    A,#05H
0025 40E5              JC      ?C0099
0027         ?C0100:
                                           ; SOURCE LINE # 737
0027 900000      E     MOV     DPTR,#GPDRE
002A E0                MOVX    A,@DPTR
002B 4480              ORL     A,#080H
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 738
002E 22                RET     
             ; FUNCTION PECI_ACToDCModeTurboCtrl (END)

             ; FUNCTION _PECI_SETPL2Watts (BEGIN)
                                           ; SOURCE LINE # 743
;---- Variable 'watts' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 744
                                           ; SOURCE LINE # 745
0000 900000      E     MOV     DPTR,#PECI_PL2Watts
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 746
0005 900000      E     MOV     DPTR,#PECI_Ctrl
0008 E0                MOVX    A,@DPTR
0009 4401              ORL     A,#01H
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 747
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 50  

000C 900000      E     MOV     DPTR,#PECI_PL2Watts
000F E0                MOVX    A,@DPTR
0010 FF                MOV     R7,A
0011 020000      R     LJMP    _PECI_WritePowerLimit2
             ; FUNCTION _PECI_SETPL2Watts (END)

             ; FUNCTION _PECI_WritePowerLimit2 (BEGIN)
                                           ; SOURCE LINE # 753
;---- Variable 'watts' assigned to Register 'R5' ----
0000 CD                XCH     A,R5
0001 EF                MOV     A,R7
0002 CD                XCH     A,R5
                                           ; SOURCE LINE # 754
                                           ; SOURCE LINE # 759
0003 120000      R     LCALL   L?0256
0006 8005              SJMP    ?C0219
0008         ?C0218:
0008 C3                CLR     C
0009 33                RLC     A
000A CE                XCH     A,R6
000B 33                RLC     A
000C CE                XCH     A,R6
000D         ?C0219:
000D D8F9              DJNZ    R0,?C0218
000F 900000      R     MOV     DPTR,#UnitofPower+01H
0012 F0                MOVX    @DPTR,A
0013 EE                MOV     A,R6
0014 900000      R     MOV     DPTR,#UnitofPower
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 760
0018 CF                XCH     A,R7
0019 ED                MOV     A,R5
001A CF                XCH     A,R7
001B 7E00              MOV     R6,#00H
001D E0                MOVX    A,@DPTR
001E FC                MOV     R4,A
001F A3                INC     DPTR
0020 E0                MOVX    A,@DPTR
0021 FD                MOV     R5,A
0022 120000      E     LCALL   ?C?IMUL
0025 900000      R     MOV     DPTR,#PL2_SettingWatts
0028 EE                MOV     A,R6
0029 F0                MOVX    @DPTR,A
002A A3                INC     DPTR
002B EF                MOV     A,R7
002C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 762
002D 900000      R     MOV     DPTR,#PL2_SettingWatts
0030 E0                MOVX    A,@DPTR
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
0033 900000      E     MOV     DPTR,#PECIWriteBuffer
0036 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 763
0037 900000      R     MOV     DPTR,#PL2_SettingWatts
003A E0                MOVX    A,@DPTR
003B 900000      E     MOV     DPTR,#PECIWriteBuffer+01H
003E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 764
003F E0                MOVX    A,@DPTR
0040 4480              ORL     A,#080H
0042 F0                MOVX    @DPTR,A
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 51  

                                           ; SOURCE LINE # 765
0043 E4                CLR     A
0044 A3                INC     DPTR
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 766
                                           ; SOURCE LINE # 767
0046 120000      R     LCALL   L?0281
0049 741B              MOV     A,#01BH
004B 120000      R     LCALL   L?0263
004E 120000      R     LCALL   _PECI_WrPkgConfig
0051 EF                MOV     A,R7
0052 6007              JZ      ?C0107
                                           ; SOURCE LINE # 768
                                           ; SOURCE LINE # 769
0054 900000      E     MOV     DPTR,#PECI_Ctrl
0057 E0                MOVX    A,@DPTR
0058 54FE              ANL     A,#0FEH
005A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 770
                                           ; SOURCE LINE # 772
                                           ; SOURCE LINE # 774
                                           ; SOURCE LINE # 780
005B         ?C0107:
005B 22                RET     
             ; FUNCTION _PECI_WritePowerLimit2 (END)

             ; FUNCTION PECI_ReadPowerLimit2 (BEGIN)
                                           ; SOURCE LINE # 785
                                           ; SOURCE LINE # 786
                                           ; SOURCE LINE # 787
0000 120000      R     LCALL   L?0253
0003 A3                INC     DPTR
0004 741B              MOV     A,#01BH
0006 120000      R     LCALL   L?0242
0009 120000      R     LCALL   _PECI_RdPkgConfig
                                           ; SOURCE LINE # 788
                                           ; SOURCE LINE # 790
000C         ?C0108:
                                           ; SOURCE LINE # 792
                                           ; SOURCE LINE # 794
                                           ; SOURCE LINE # 795
000C         ?C0110:
000C 22                RET     
             ; FUNCTION PECI_ReadPowerLimit2 (END)

             ; FUNCTION PECI_ReadCPUTemp (BEGIN)
                                           ; SOURCE LINE # 800
                                           ; SOURCE LINE # 801
                                           ; SOURCE LINE # 805
0000 7C00        E     MOV     R4,#HIGH PECIReadBuffer
0002 7D00        E     MOV     R5,#LOW PECIReadBuffer
0004 900000      R     MOV     DPTR,#?_PECI_GetTemp?BYTE+04H
0007 7402              MOV     A,#02H
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B 14                DEC     A
000C F0                MOVX    @DPTR,A
000D E4                CLR     A
000E FB                MOV     R3,A
000F 7F30              MOV     R7,#030H
0011 120000      R     LCALL   _PECI_GetTemp
0014 EF                MOV     A,R7
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 52  

0015 6036              JZ      ?C0115
                                           ; SOURCE LINE # 806
                                           ; SOURCE LINE # 807
0017 120000      R     LCALL   L?0268
001A FF                MOV     R7,A
001B EC                MOV     A,R4
001C 3E                ADDC    A,R6
001D 900000      R     MOV     DPTR,#cputemp
0020 F0                MOVX    @DPTR,A
0021 A3                INC     DPTR
0022 EF                MOV     A,R7
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 808
0024 900000      R     MOV     DPTR,#cputemp
0027 E0                MOVX    A,@DPTR
0028 FE                MOV     R6,A
0029 A3                INC     DPTR
002A E0                MOVX    A,@DPTR
002B 900000      R     MOV     DPTR,#cputemp
002E 120000      R     LCALL   L?0265
                                           ; SOURCE LINE # 809
0031 900000      R     MOV     DPTR,#cputemp
0034 E0                MOVX    A,@DPTR
0035 FE                MOV     R6,A
0036 A3                INC     DPTR
0037 E0                MOVX    A,@DPTR
0038 7806              MOV     R0,#06H
003A         ?C0220:
003A CE                XCH     A,R6
003B C3                CLR     C
003C 13                RRC     A
003D CE                XCH     A,R6
003E 13                RRC     A
003F D8F9              DJNZ    R0,?C0220
;---- Variable 'tempoffset' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 810
0041 120000      R     LCALL   L?0286
0044 5007              JNC     ?C0115
                                           ; SOURCE LINE # 811
                                           ; SOURCE LINE # 812
0046 E0                MOVX    A,@DPTR
0047 C3                CLR     C
0048 9F                SUBB    A,R7
0049 900000      E     MOV     DPTR,#PECI_CPU_temp
004C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 813
                                           ; SOURCE LINE # 815
                                           ; SOURCE LINE # 817
                                           ; SOURCE LINE # 818
                                           ; SOURCE LINE # 820
                                           ; SOURCE LINE # 822
                                           ; SOURCE LINE # 823
004D         ?C0115:
004D 22                RET     
             ; FUNCTION PECI_ReadCPUTemp (END)

             ; FUNCTION PECI_ReadCPUTJMAX (BEGIN)
                                           ; SOURCE LINE # 828
                                           ; SOURCE LINE # 829
                                           ; SOURCE LINE # 830
0000 120000      R     LCALL   L?0253
0003 A3                INC     DPTR
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 53  

0004 7410              MOV     A,#010H
0006 120000      R     LCALL   L?0242
0009 120000      R     LCALL   _PECI_RdPkgConfig
000C EF                MOV     A,R7
000D 600E              JZ      ?C0116
                                           ; SOURCE LINE # 831
                                           ; SOURCE LINE # 832
000F E4                CLR     A
0010 900000      E     MOV     DPTR,#ReadCPUTjmaxCUNT
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 833
0014 900000      E     MOV     DPTR,#PECIReadBuffer+02H
0017 E0                MOVX    A,@DPTR
0018 900000      E     MOV     DPTR,#CPUTjmax
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 834
001C 22                RET     
001D         ?C0116:
                                           ; SOURCE LINE # 836
                                           ; SOURCE LINE # 837
001D 900000      E     MOV     DPTR,#ReadCPUTjmaxCUNT
0020 E0                MOVX    A,@DPTR
0021 04                INC     A
0022 F0                MOVX    @DPTR,A
0023 C3                CLR     C
0024 940A              SUBB    A,#0AH
0026 4008              JC      ?C0119
                                           ; SOURCE LINE # 838
                                           ; SOURCE LINE # 839
0028 E4                CLR     A
0029 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 840
002A 900000      E     MOV     DPTR,#CPUTjmax
002D 7464              MOV     A,#064H
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 841
                                           ; SOURCE LINE # 842
                                           ; SOURCE LINE # 843
0030         ?C0119:
0030 22                RET     
             ; FUNCTION PECI_ReadCPUTJMAX (END)

             ; FUNCTION PECI_ReadDRAMTemperature (BEGIN)
                                           ; SOURCE LINE # 848
                                           ; SOURCE LINE # 849
                                           ; SOURCE LINE # 850
0000 120000      R     LCALL   L?0253
0003 A3                INC     DPTR
0004 7416              MOV     A,#016H
0006 120000      R     LCALL   L?0242
0009 120000      R     LCALL   _PECI_RdPkgConfig
000C EF                MOV     A,R7
000D 6010              JZ      ?C0122
                                           ; SOURCE LINE # 851
                                           ; SOURCE LINE # 852
000F 900000      E     MOV     DPTR,#PECIReadBuffer
0012 E0                MOVX    A,@DPTR
0013 900000      E     MOV     DPTR,#TDIM0_temp
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 853
0017 900000      E     MOV     DPTR,#PECIReadBuffer+01H
001A E0                MOVX    A,@DPTR
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 54  

001B 900000      E     MOV     DPTR,#TDIM1_temp
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 854
                                           ; SOURCE LINE # 856
                                           ; SOURCE LINE # 858
                                           ; SOURCE LINE # 859
001F         ?C0122:
001F 22                RET     
             ; FUNCTION PECI_ReadDRAMTemperature (END)

             ; FUNCTION PECI_ReadPkgTemperature (BEGIN)
                                           ; SOURCE LINE # 864
                                           ; SOURCE LINE # 865
                                           ; SOURCE LINE # 868
0000 120000      R     LCALL   L?0253
0003 A3                INC     DPTR
0004 7402              MOV     A,#02H
0006 F0                MOVX    @DPTR,A
0007 A3                INC     DPTR
0008 74FF              MOV     A,#0FFH
000A F0                MOVX    @DPTR,A
000B E4                CLR     A
000C 120000      R     LCALL   L?0243
000F 120000      R     LCALL   _PECI_RdPkgConfig
0012 EF                MOV     A,R7
0013 6036              JZ      ?C0126
                                           ; SOURCE LINE # 869
                                           ; SOURCE LINE # 870
0015 120000      R     LCALL   L?0268
0018 FF                MOV     R7,A
0019 EC                MOV     A,R4
001A 3E                ADDC    A,R6
001B 900000      R     MOV     DPTR,#pkgtemp
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 EF                MOV     A,R7
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 871
0022 900000      R     MOV     DPTR,#pkgtemp
0025 E0                MOVX    A,@DPTR
0026 FE                MOV     R6,A
0027 A3                INC     DPTR
0028 E0                MOVX    A,@DPTR
0029 900000      R     MOV     DPTR,#pkgtemp
002C 120000      R     LCALL   L?0265
                                           ; SOURCE LINE # 872
002F 900000      R     MOV     DPTR,#pkgtemp
0032 E0                MOVX    A,@DPTR
0033 FE                MOV     R6,A
0034 A3                INC     DPTR
0035 E0                MOVX    A,@DPTR
0036 7806              MOV     R0,#06H
0038         ?C0221:
0038 CE                XCH     A,R6
0039 C3                CLR     C
003A 13                RRC     A
003B CE                XCH     A,R6
003C 13                RRC     A
003D D8F9              DJNZ    R0,?C0221
;---- Variable 'tempoffset' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 873
003F 120000      R     LCALL   L?0286
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 55  

0042 5007              JNC     ?C0126
                                           ; SOURCE LINE # 874
                                           ; SOURCE LINE # 875
0044 E0                MOVX    A,@DPTR
0045 C3                CLR     C
0046 9F                SUBB    A,R7
0047 900000      E     MOV     DPTR,#TPkg_temp
004A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 876
                                           ; SOURCE LINE # 877
                                           ; SOURCE LINE # 879
                                           ; SOURCE LINE # 881
                                           ; SOURCE LINE # 882
004B         ?C0126:
004B 22                RET     
             ; FUNCTION PECI_ReadPkgTemperature (END)

             ; FUNCTION PECI_ReadMSRExample (BEGIN)
                                           ; SOURCE LINE # 887
                                           ; SOURCE LINE # 888
                                           ; SOURCE LINE # 889
0000 900000      R     MOV     DPTR,#?_PECI_RdIAMSR?BYTE+04H
0003 120000      R     LCALL   L?0254
0006 A3                INC     DPTR
0007 F0                MOVX    @DPTR,A
0008 A3                INC     DPTR
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B 7404              MOV     A,#04H
000D F0                MOVX    @DPTR,A
000E A3                INC     DPTR
000F 7409              MOV     A,#09H
0011 F0                MOVX    @DPTR,A
0012 7405              MOV     A,#05H
0014 120000      R     LCALL   L?0264
0017 120000      R     LCALL   _PECI_RdIAMSR
                                           ; SOURCE LINE # 890
                                           ; SOURCE LINE # 892
001A         ?C0127:
                                           ; SOURCE LINE # 894
                                           ; SOURCE LINE # 896
                                           ; SOURCE LINE # 897
001A         ?C0129:
001A 22                RET     
             ; FUNCTION PECI_ReadMSRExample (END)

             ; FUNCTION PECI_CheckCurrentPlatformPower (BEGIN)
                                           ; SOURCE LINE # 902
                                           ; SOURCE LINE # 903
                                           ; SOURCE LINE # 907
0000 22                RET     
             ; FUNCTION PECI_CheckCurrentPlatformPower (END)

             ; FUNCTION PECI_ACTurboControlAlgorithm (BEGIN)
                                           ; SOURCE LINE # 912
                                           ; SOURCE LINE # 913
                                           ; SOURCE LINE # 920
0000 900000      E     MOV     DPTR,#PECI_Ctrl
0003 E0                MOVX    A,@DPTR
0004 20E051            JB      ACC.0,?C0131
                                           ; SOURCE LINE # 921
                                           ; SOURCE LINE # 922
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 56  

;---- Variable 'UpdatPL2' assigned to Register 'R7' ----
0007 E4                CLR     A
0008 FF                MOV     R7,A
                                           ; SOURCE LINE # 923
;---- Variable 'BATTERY_CHARGE_BUDGET' assigned to Register 'R6' ----
0009 FE                MOV     R6,A
                                           ; SOURCE LINE # 937
000A 900000      E     MOV     DPTR,#PECI_AdaptorWatts
000D E0                MOVX    A,@DPTR
000E FD                MOV     R5,A
000F 900000      E     MOV     DPTR,#PECI_PL2Watts
0012 E0                MOVX    A,@DPTR
0013 2D                ADD     A,R5
0014 FD                MOV     R5,A
0015 900000      E     MOV     DPTR,#PECI_SystemWatts
0018 E0                MOVX    A,@DPTR
0019 FC                MOV     R4,A
001A C3                CLR     C
001B ED                MOV     A,R5
001C 9C                SUBB    A,R4
001D C3                CLR     C
001E 9E                SUBB    A,R6
001F FE                MOV     R6,A
;---- Variable 'NewPL2Watts' assigned to Register 'R6' ----
                                           ; SOURCE LINE # 939
0020 900000      E     MOV     DPTR,#PECI_MAXPL2
0023 E0                MOVX    A,@DPTR
0024 FD                MOV     R5,A
0025 EE                MOV     A,R6
0026 D3                SETB    C
0027 9D                SUBB    A,R5
0028 4008              JC      ?C0132
                                           ; SOURCE LINE # 940
                                           ; SOURCE LINE # 941
                                           ; SOURCE LINE # 942
002A 120000      R     LCALL   L?0287
002D 601F              JZ      ?C0134
                                           ; SOURCE LINE # 943
                                           ; SOURCE LINE # 944
002F 0F                INC     R7
                                           ; SOURCE LINE # 945
                                           ; SOURCE LINE # 947
0030 801C              SJMP    ?C0134
0032         ?C0132:
                                           ; SOURCE LINE # 948
0032 900000      E     MOV     DPTR,#PECI_PL1TDP
0035 E0                MOVX    A,@DPTR
0036 FD                MOV     R5,A
0037 EE                MOV     A,R6
0038 C3                CLR     C
0039 9D                SUBB    A,R5
003A 5009              JNC     ?C0135
                                           ; SOURCE LINE # 949
                                           ; SOURCE LINE # 950
                                           ; SOURCE LINE # 951
003C 120000      R     LCALL   L?0287
003F 600D              JZ      ?C0134
                                           ; SOURCE LINE # 952
                                           ; SOURCE LINE # 953
0041 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 954
                                           ; SOURCE LINE # 956
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 57  

0043 8009              SJMP    ?C0134
0045         ?C0135:
                                           ; SOURCE LINE # 958
                                           ; SOURCE LINE # 959
0045 900000      E     MOV     DPTR,#PECI_PL2Watts
0048 E0                MOVX    A,@DPTR
0049 6E                XRL     A,R6
004A 6002              JZ      ?C0134
                                           ; SOURCE LINE # 960
                                           ; SOURCE LINE # 961
004C 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 962
                                           ; SOURCE LINE # 963
004E         ?C0134:
                                           ; SOURCE LINE # 965
004E EF                MOV     A,R7
004F B4010E            CJNE    A,#01H,?C0141
                                           ; SOURCE LINE # 966
                                           ; SOURCE LINE # 967
0052 CF                XCH     A,R7
0053 EE                MOV     A,R6
0054 CF                XCH     A,R7
0055 020000      R     LJMP    _PECI_SETPL2Watts
                                           ; SOURCE LINE # 968
                                           ; SOURCE LINE # 969
0058         ?C0131:
                                           ; SOURCE LINE # 971
                                           ; SOURCE LINE # 972
0058 900000      E     MOV     DPTR,#PECI_PL2Watts
005B E0                MOVX    A,@DPTR
005C FF                MOV     R7,A
005D 120000      R     LCALL   _PECI_WritePowerLimit2
                                           ; SOURCE LINE # 973
                                           ; SOURCE LINE # 974
0060         ?C0141:
0060 22                RET     
             ; FUNCTION PECI_ACTurboControlAlgorithm (END)

             ; FUNCTION ChecknSetAdaptorWatts (BEGIN)
                                           ; SOURCE LINE # 979
                                           ; SOURCE LINE # 980
                                           ; SOURCE LINE # 981
0000 900000      E     MOV     DPTR,#PECI_AdaptorWatts
0003 7441              MOV     A,#041H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 982
0006 900000      E     MOV     DPTR,#PECI_MAXPL2
0009 743C              MOV     A,#03CH
000B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 983
000C 22                RET     
             ; FUNCTION ChecknSetAdaptorWatts (END)

             ; FUNCTION PECI_PowerCtrlAlgorithm (BEGIN)
                                           ; SOURCE LINE # 988
                                           ; SOURCE LINE # 989
                                           ; SOURCE LINE # 990
0000 900000      E     MOV     DPTR,#PECI_PowerCtrlStep
0003 E0                MOVX    A,@DPTR
0004 24FE              ADD     A,#0FEH
0006 6020              JZ      ?C0148
0008 14                DEC     A
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 58  

0009 6029              JZ      ?C0150
000B 14                DEC     A
000C 6042              JZ      ?C0154
000E 14                DEC     A
000F 6049              JZ      ?C0156
0011 24F4              ADD     A,#0F4H
0013 6055              JZ      ?C0159
0015 2410              ADD     A,#010H
0017 7059              JNZ     ?C0161
                                           ; SOURCE LINE # 991
                                           ; SOURCE LINE # 992
0019         ?C0144:
                                           ; SOURCE LINE # 993
0019 900000      E     MOV     DPTR,#SysPowState
001C E0                MOVX    A,@DPTR
001D 6410              XRL     A,#010H
001F 7051              JNZ     ?C0161
                                           ; SOURCE LINE # 994
                                           ; SOURCE LINE # 995
                                           ; SOURCE LINE # 996
                                           ; SOURCE LINE # 997
0021 120000      R     LCALL   ChecknSetAdaptorWatts
                                           ; SOURCE LINE # 998
0024 7F02              MOV     R7,#02H
                                           ; SOURCE LINE # 999
0026 8047              SJMP    ?C0235
                                           ; SOURCE LINE # 1001
                                           ; SOURCE LINE # 1003
                                           ; SOURCE LINE # 1004
                                           ; SOURCE LINE # 1005
                                           ; SOURCE LINE # 1007
0028         ?C0148:
                                           ; SOURCE LINE # 1008
0028 120000      R     LCALL   PECI_ReadPowerUnit
002B EF                MOV     A,R7
002C 6401              XRL     A,#01H
002E 7042              JNZ     ?C0161
                                           ; SOURCE LINE # 1009
                                           ; SOURCE LINE # 1010
0030 7F03              MOV     R7,#03H
0032         ?C0231:
                                           ; SOURCE LINE # 1011
                                           ; SOURCE LINE # 1012
0032 803B              SJMP    ?C0235
                                           ; SOURCE LINE # 1014
0034         ?C0150:
                                           ; SOURCE LINE # 1015
0034 120000      R     LCALL   PECI_ReadPowerLimit1
0037 EF                MOV     A,R7
0038 6401              XRL     A,#01H
003A 7036              JNZ     ?C0161
                                           ; SOURCE LINE # 1016
                                           ; SOURCE LINE # 1017
003C 900000      E     MOV     DPTR,#PECI_PL1TDP
003F E0                MOVX    A,@DPTR
0040 6004              JZ      ?C0152
                                           ; SOURCE LINE # 1018
                                           ; SOURCE LINE # 1019
0042 7F05              MOV     R7,#05H
0044         ?C0232:
                                           ; SOURCE LINE # 1020
0044 8029              SJMP    ?C0235
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 59  

0046         ?C0152:
                                           ; SOURCE LINE # 1022
                                           ; SOURCE LINE # 1023
0046 900000      E     MOV     DPTR,#PECI_PL1TDP
0049 742D              MOV     A,#02DH
004B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1024
004C 7F04              MOV     R7,#04H
004E         ?C0233:
                                           ; SOURCE LINE # 1025
                                           ; SOURCE LINE # 1026
                                           ; SOURCE LINE # 1027
004E 801F              SJMP    ?C0235
                                           ; SOURCE LINE # 1029
0050         ?C0154:
                                           ; SOURCE LINE # 1030
0050 120000      R     LCALL   PECI_WritePowerLimit1
0053 BF011C            CJNE    R7,#01H,?C0161
                                           ; SOURCE LINE # 1031
                                           ; SOURCE LINE # 1032
0056 7F05              MOV     R7,#05H
0058         ?C0234:
                                           ; SOURCE LINE # 1033
                                           ; SOURCE LINE # 1034
0058 8015              SJMP    ?C0235
                                           ; SOURCE LINE # 1036
005A         ?C0156:
                                           ; SOURCE LINE # 1037
005A 900000      E     MOV     DPTR,#PECI_Algorithm_Delay
005D E0                MOVX    A,@DPTR
005E 04                INC     A
005F F0                MOVX    @DPTR,A
0060 C3                CLR     C
0061 9464              SUBB    A,#064H
0063 400D              JC      ?C0161
                                           ; SOURCE LINE # 1038
                                           ; SOURCE LINE # 1039
0065 E4                CLR     A
0066 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1040
0067 020000      R     LJMP    PECI_ACTurboControlAlgorithm
                                           ; SOURCE LINE # 1041
                                           ; SOURCE LINE # 1042
                                           ; SOURCE LINE # 1044
                                           ; SOURCE LINE # 1045
                                           ; SOURCE LINE # 1047
006A         ?C0159:
                                           ; SOURCE LINE # 1048
006A 120000      R     LCALL   PECI_ClearTCVariables
                                           ; SOURCE LINE # 1049
006D 7F10              MOV     R7,#010H
006F         ?C0235:
006F 120000      R     LCALL   _SetPECIPowerCtrlStep
                                           ; SOURCE LINE # 1050
                                           ; SOURCE LINE # 1052
                                           ; SOURCE LINE # 1053
                                           ; SOURCE LINE # 1054
                                           ; SOURCE LINE # 1055
0072         ?C0161:
0072 22                RET     
             ; FUNCTION PECI_PowerCtrlAlgorithm (END)

C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 60  

             ; FUNCTION PECI_PowerCtrlCenter (BEGIN)
                                           ; SOURCE LINE # 1060
                                           ; SOURCE LINE # 1061
                                           ; SOURCE LINE # 1062
0000 900000      E     MOV     DPTR,#SysPowState
0003 E0                MOVX    A,@DPTR
0004 6410              XRL     A,#010H
0006 7024              JNZ     ?C0162
                                           ; SOURCE LINE # 1063
                                           ; SOURCE LINE # 1064
0008 900000      E     MOV     DPTR,#PSTB_CmdStatus
000B E0                MOVX    A,@DPTR
000C 30E01D            JNB     ACC.0,?C0162
                                           ; SOURCE LINE # 1065
                                           ; SOURCE LINE # 1066
000F 900000      E     MOV     DPTR,#PSTB_Timer
0012 E0                MOVX    A,@DPTR
0013 04                INC     A
0014 F0                MOVX    @DPTR,A
0015 C3                CLR     C
0016 9402              SUBB    A,#02H
0018 401C              JC      ?C0167
                                           ; SOURCE LINE # 1067
                                           ; SOURCE LINE # 1068
001A E4                CLR     A
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1069
001C 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
001F E0                MOVX    A,@DPTR
0020 7003              JNZ     ?C0165
                                           ; SOURCE LINE # 1070
                                           ; SOURCE LINE # 1071
0022 020000      R     LJMP    ProcessPSTCmd
                                           ; SOURCE LINE # 1072
0025         ?C0165:
                                           ; SOURCE LINE # 1074
                                           ; SOURCE LINE # 1075
0025 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
0028 E0                MOVX    A,@DPTR
0029 14                DEC     A
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1076
                                           ; SOURCE LINE # 1077
002B 22                RET     
                                           ; SOURCE LINE # 1079
                                           ; SOURCE LINE # 1080
002C         ?C0162:
                                           ; SOURCE LINE # 1082
002C 900000      E     MOV     DPTR,#SysPowState
002F E0                MOVX    A,@DPTR
0030 B41003            CJNE    A,#010H,?C0167
                                           ; SOURCE LINE # 1083
                                           ; SOURCE LINE # 1084
0033 120000      R     LCALL   PECI_CheckCurrentPlatformPower
                                           ; SOURCE LINE # 1085
                                           ; SOURCE LINE # 1094
0036         ?C0167:
0036 22                RET     
             ; FUNCTION PECI_PowerCtrlCenter (END)

             ; FUNCTION _SetPECIPowerCtrlStep (BEGIN)
                                           ; SOURCE LINE # 1099
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 61  

;---- Variable 'step' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 1100
                                           ; SOURCE LINE # 1101
0000 900000      E     MOV     DPTR,#PECI_PowerCtrlStep
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1102
0005 22                RET     
             ; FUNCTION _SetPECIPowerCtrlStep (END)

             ; FUNCTION ProcessPSTCmd (BEGIN)
                                           ; SOURCE LINE # 1110
                                           ; SOURCE LINE # 1111
                                           ; SOURCE LINE # 1116
0000 E4                CLR     A
0001 900000      R     MOV     DPTR,#error
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1117
0005 900000      R     MOV     DPTR,#bufindex
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1119
0009 900000      R     MOV     DPTR,#bufpoint
000C 7400        E     MOV     A,#HIGH PSTB_RepeatCycle
000E F0                MOVX    @DPTR,A
000F A3                INC     DPTR
0010 7400        E     MOV     A,#LOW PSTB_RepeatCycle
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1121
0013 E4                CLR     A
0014 FF                MOV     R7,A
0015 FE                MOV     R6,A
0016 FD                MOV     R5,A
0017 FC                MOV     R4,A
0018 900000      E     MOV     DPTR,#PSTB_RepeatCycle
001B 120000      E     LCALL   ?C?LLDXDATA0
001E C3                CLR     C
001F 120000      E     LCALL   ?C?ULCMP
0022 7003              JNZ     $ + 5H
0024 020000      R     LJMP    ?C0170
                                           ; SOURCE LINE # 1122
                                           ; SOURCE LINE # 1123
0027 900000      E     MOV     DPTR,#PECI_StressToolBuf+07H
002A E0                MOVX    A,@DPTR
;---- Variable 'writelen' assigned to Register 'R6' ----
002B FE                MOV     R6,A
                                           ; SOURCE LINE # 1124
002C A3                INC     DPTR
002D E0                MOVX    A,@DPTR
;---- Variable 'readlen' assigned to Register 'R2' ----
002E FA                MOV     R2,A
                                           ; SOURCE LINE # 1126
002F 120000      R     LCALL   PECI_HostEnable
                                           ; SOURCE LINE # 1127
0032 900000      E     MOV     DPTR,#PECI_StressToolBuf+06H
0035 E0                MOVX    A,@DPTR
0036 900000      E     MOV     DPTR,#HOTRADDR
0039 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1128
003A 900000      E     MOV     DPTR,#PECI_StressToolBuf+07H
003D E0                MOVX    A,@DPTR
003E 900000      E     MOV     DPTR,#HOWRLR
0041 F0                MOVX    @DPTR,A
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 62  

                                           ; SOURCE LINE # 1129
0042 900000      E     MOV     DPTR,#PECI_StressToolBuf+08H
0045 E0                MOVX    A,@DPTR
0046 900000      E     MOV     DPTR,#HORDLR
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1131
004A EE                MOV     A,R6
004B 600A              JZ      ?C0171
                                           ; SOURCE LINE # 1132
                                           ; SOURCE LINE # 1133
004D 900000      E     MOV     DPTR,#PECI_StressToolBuf+09H
0050 E0                MOVX    A,@DPTR
0051 900000      E     MOV     DPTR,#HOCMDR
                                           ; SOURCE LINE # 1134
                                           ; SOURCE LINE # 1135
0054 120000      R     LCALL   L?0266
                                           ; SOURCE LINE # 1136
0057         ?C0171:
                                           ; SOURCE LINE # 1137
0057 900000      E     MOV     DPTR,#PECI_StressToolBuf+09H
005A E0                MOVX    A,@DPTR
005B B4A506            CJNE    A,#0A5H,?C0173
                                           ; SOURCE LINE # 1138
                                           ; SOURCE LINE # 1139
005E 7F02              MOV     R7,#02H
0060 120000      R     LCALL   _PECI_HostControl
                                           ; SOURCE LINE # 1140
0063 1E                DEC     R6
                                           ; SOURCE LINE # 1141
0064         ?C0173:
                                           ; SOURCE LINE # 1143
0064 EE                MOV     A,R6
0065 600C              JZ      ?C0174
                                           ; SOURCE LINE # 1144
                                           ; SOURCE LINE # 1145
0067 120000      R     LCALL   L?0261
006A E0                MOVX    A,@DPTR
006B 900000      E     MOV     DPTR,#HOWRDR
                                           ; SOURCE LINE # 1146
                                           ; SOURCE LINE # 1147
006E 120000      R     LCALL   L?0266
                                           ; SOURCE LINE # 1148
0071 80F1              SJMP    ?C0173
0073         ?C0174:
                                           ; SOURCE LINE # 1150
0073 120000      R     LCALL   PECI_CheckHostBusy
0076 EF                MOV     A,R7
0077 602B              JZ      ?C0175
                                           ; SOURCE LINE # 1151
                                           ; SOURCE LINE # 1152
                                           ; SOURCE LINE # 1153
0079 120000      R     LCALL   L?0251
007C 6026              JZ      ?C0237
                                           ; SOURCE LINE # 1154
                                           ; SOURCE LINE # 1155
007E 900000      E     MOV     DPTR,#PECI_StressToolBuf+09H
0081 E0                MOVX    A,@DPTR
0082 B4A503            CJNE    A,#0A5H,?C0177
                                           ; SOURCE LINE # 1156
                                           ; SOURCE LINE # 1157
0085 120000      R     LCALL   L?0267
                                           ; SOURCE LINE # 1158
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 63  

0088         ?C0177:
                                           ; SOURCE LINE # 1159
0088 800E              SJMP    ?C0236
008A         ?C0178:
                                           ; SOURCE LINE # 1161
008A EA                MOV     A,R2
008B 6010              JZ      ?C0179
                                           ; SOURCE LINE # 1162
                                           ; SOURCE LINE # 1163
008D 900000      E     MOV     DPTR,#HORDDR
0090 E0                MOVX    A,@DPTR
0091 FF                MOV     R7,A
0092 120000      R     LCALL   L?0261
0095 EF                MOV     A,R7
0096 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1164
0097 1A                DEC     R2
                                           ; SOURCE LINE # 1165
0098         ?C0236:
0098 120000      R     LCALL   L?0267
                                           ; SOURCE LINE # 1166
009B 80ED              SJMP    ?C0178
009D         ?C0179:
                                           ; SOURCE LINE # 1167
009D E4                CLR     A
009E 900000      R     MOV     DPTR,#error
00A1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1168
00A2 8006              SJMP    ?C0181
00A4         ?C0175:
                                           ; SOURCE LINE # 1175
                                           ; SOURCE LINE # 1176
00A4         ?C0237:
00A4 900000      R     MOV     DPTR,#error
00A7 7401              MOV     A,#01H
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1177
00AA         ?C0181:
                                           ; SOURCE LINE # 1179
00AA 900000      E     MOV     DPTR,#PSTB_RepeatCycle
00AD 120000      E     LCALL   ?C?LLDXDATA
00B0 EF                MOV     A,R7
00B1 24FF              ADD     A,#0FFH
00B3 FF                MOV     R7,A
00B4 EE                MOV     A,R6
00B5 34FF              ADDC    A,#0FFH
00B7 FE                MOV     R6,A
00B8 ED                MOV     A,R5
00B9 34FF              ADDC    A,#0FFH
00BB FD                MOV     R5,A
00BC EC                MOV     A,R4
00BD 34FF              ADDC    A,#0FFH
00BF FC                MOV     R4,A
00C0 900000      E     MOV     DPTR,#PSTB_RepeatCycle
00C3 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1180
00C6 120000      R     LCALL   L?0246
00C9 900000      E     MOV     DPTR,#PECI_StressToolBuf+03H
                                           ; SOURCE LINE # 1181
                                           ; SOURCE LINE # 1182
00CC 120000      R     LCALL   L?0244
00CF 900000      E     MOV     DPTR,#PECI_StressToolBuf+02H
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 64  

                                           ; SOURCE LINE # 1183
                                           ; SOURCE LINE # 1184
00D2 120000      R     LCALL   L?0244
00D5 900000      E     MOV     DPTR,#PECI_StressToolBuf+01H
                                           ; SOURCE LINE # 1185
                                           ; SOURCE LINE # 1186
00D8 120000      R     LCALL   L?0245
00DB 900000      E     MOV     DPTR,#PECI_StressToolBuf
00DE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1188
00DF 900000      E     MOV     DPTR,#PECI_StressToolBuf+04H
00E2 E0                MOVX    A,@DPTR
00E3 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
00E6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1189
00E7 120000      R     LCALL   PECI_HostDisable
                                           ; SOURCE LINE # 1190
00EA 120000      R     LCALL   ResetPECIStatus
                                           ; SOURCE LINE # 1192
00ED 900000      R     MOV     DPTR,#error
00F0 E0                MOVX    A,@DPTR
00F1 6401              XRL     A,#01H
00F3 7042              JNZ     ?C0188
                                           ; SOURCE LINE # 1193
                                           ; SOURCE LINE # 1194
00F5 900000      E     MOV     DPTR,#PECI_StressToolBuf+09H
00F8 E0                MOVX    A,@DPTR
00F9 B4A503            CJNE    A,#0A5H,?C0183
                                           ; SOURCE LINE # 1195
                                           ; SOURCE LINE # 1196
00FC 120000      R     LCALL   L?0267
                                           ; SOURCE LINE # 1197
00FF         ?C0183:
                                           ; SOURCE LINE # 1198
00FF 8009              SJMP    ?C0238
0101         ?C0184:
                                           ; SOURCE LINE # 1200
0101 EA                MOV     A,R2
0102 600B              JZ      ?C0185
                                           ; SOURCE LINE # 1201
                                           ; SOURCE LINE # 1202
0104 120000      R     LCALL   L?0262
0107 E4                CLR     A
0108 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1203
0109 1A                DEC     R2
                                           ; SOURCE LINE # 1204
010A         ?C0238:
010A 120000      R     LCALL   L?0267
                                           ; SOURCE LINE # 1205
010D 80F2              SJMP    ?C0184
010F         ?C0185:
                                           ; SOURCE LINE # 1207
010F 900000      E     MOV     DPTR,#PECI_ErrorCount
0112 120000      E     LCALL   ?C?LLDXDATA
0115 EF                MOV     A,R7
0116 2401              ADD     A,#01H
0118 FF                MOV     R7,A
0119 E4                CLR     A
011A 3E                ADDC    A,R6
011B FE                MOV     R6,A
011C E4                CLR     A
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 65  

011D 3D                ADDC    A,R5
011E FD                MOV     R5,A
011F E4                CLR     A
0120 3C                ADDC    A,R4
0121 FC                MOV     R4,A
0122 900000      E     MOV     DPTR,#PECI_ErrorCount
0125 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 1208
0128 900000      E     MOV     DPTR,#PECI_StressToolBuf+05H
012B E0                MOVX    A,@DPTR
012C 6009              JZ      ?C0188
                                           ; SOURCE LINE # 1209
                                           ; SOURCE LINE # 1210
                                           ; SOURCE LINE # 1211
                                           ; SOURCE LINE # 1212
                                           ; SOURCE LINE # 1213
012E 8000              SJMP    ?C0239
0130         ?C0170:
                                           ; SOURCE LINE # 1215
                                           ; SOURCE LINE # 1216
0130         ?C0239:
0130 900000      E     MOV     DPTR,#PSTB_CmdStatus
0133 E0                MOVX    A,@DPTR
0134 54FE              ANL     A,#0FEH
0136 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1217
                                           ; SOURCE LINE # 1218
0137         ?C0188:
0137 22                RET     
             ; FUNCTION ProcessPSTCmd (END)

             ; FUNCTION PECI_PSTIssueCmd (BEGIN)
                                           ; SOURCE LINE # 1223
                                           ; SOURCE LINE # 1224
                                           ; SOURCE LINE # 1227
0000 900000      E     MOV     DPTR,#PECI_ErrorCount
0003 120000      E     LCALL   ?C?LSTKXDATA
0006 00                DB      00H
0007 00                DB      00H
0008 00                DB      00H
0009 00                DB      00H
                                           ; SOURCE LINE # 1228
000A E4                CLR     A
000B 900000      E     MOV     DPTR,#PSTB_Timer
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1229
000F 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1230
0013 900000      E     MOV     DPTR,#PSTB_CmdStatus
0016 E0                MOVX    A,@DPTR
0017 4401              ORL     A,#01H
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1231
001A 7E00        E     MOV     R6,#HIGH PSTB_RepeatCycle
001C 7F00        E     MOV     R7,#LOW PSTB_RepeatCycle
;---- Variable 'xptr' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 1232
001E 900000      E     MOV     DPTR,#PECI_StressToolBuf+03H
0021 120000      R     LCALL   L?0279
                                           ; SOURCE LINE # 1233
0024 0F                INC     R7
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 66  

0025 BF0001            CJNE    R7,#00H,?C0222
0028 0E                INC     R6
0029         ?C0222:
                                           ; SOURCE LINE # 1234
0029 900000      E     MOV     DPTR,#PECI_StressToolBuf+02H
002C 120000      R     LCALL   L?0279
                                           ; SOURCE LINE # 1235
002F 0F                INC     R7
0030 BF0001            CJNE    R7,#00H,?C0223
0033 0E                INC     R6
0034         ?C0223:
                                           ; SOURCE LINE # 1236
0034 900000      E     MOV     DPTR,#PECI_StressToolBuf+01H
0037 120000      R     LCALL   L?0280
                                           ; SOURCE LINE # 1237
003A 0F                INC     R7
003B BF0001            CJNE    R7,#00H,?C0224
003E 0E                INC     R6
003F         ?C0224:
                                           ; SOURCE LINE # 1238
003F 900000      E     MOV     DPTR,#PECI_StressToolBuf
0042 120000      R     LCALL   L?0280
                                           ; SOURCE LINE # 1239
0045 22                RET     
             ; FUNCTION PECI_PSTIssueCmd (END)

             ; FUNCTION PECI_PSTEndCmd (BEGIN)
                                           ; SOURCE LINE # 1244
                                           ; SOURCE LINE # 1245
                                           ; SOURCE LINE # 1246
0000 020000      R     LJMP    PECI_ClearPSTVariables
             ; FUNCTION PECI_PSTEndCmd (END)

             ; FUNCTION PECI_PSTWriteBuffer (BEGIN)
                                           ; SOURCE LINE # 1252
                                           ; SOURCE LINE # 1253
                                           ; SOURCE LINE # 1254
0000 AF00        E     MOV     R7,PM3DataCount
0002 C3                CLR     C
0003 7418              MOV     A,#018H
0005 9F                SUBB    A,R7
0006 FF                MOV     R7,A
0007 E4                CLR     A
0008 9400              SUBB    A,#00H
000A FE                MOV     R6,A
000B 7400        E     MOV     A,#LOW PECI_StressToolBuf
000D 2F                ADD     A,R7
000E F582              MOV     DPL,A
0010 7400        E     MOV     A,#HIGH PECI_StressToolBuf
0012 3E                ADDC    A,R6
0013 F583              MOV     DPH,A
0015 E500        E     MOV     A,PM3Data
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1255
0018 22                RET     
             ; FUNCTION PECI_PSTWriteBuffer (END)

             ; FUNCTION PECI_PSTReadBuffer (BEGIN)
                                           ; SOURCE LINE # 1260
                                           ; SOURCE LINE # 1261
                                           ; SOURCE LINE # 1262
0000 900000      E     MOV     DPTR,#StressToolReadBufIndex
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 67  

0003 7418              MOV     A,#018H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1309
0006 22                RET     
             ; FUNCTION PECI_PSTReadBuffer (END)

             ; FUNCTION PECI_PSTReadErrorCount (BEGIN)
                                           ; SOURCE LINE # 1315
                                           ; SOURCE LINE # 1316
                                           ; SOURCE LINE # 1321
;---- Variable 'timeout' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 1323
0002 7C00        E     MOV     R4,#HIGH PECI_ErrorCount
0004 7D00        E     MOV     R5,#LOW PECI_ErrorCount
;---- Variable 'xptr' assigned to Register 'R4/R5' ----
                                           ; SOURCE LINE # 1324
0006 8D82              MOV     DPL,R5
0008 8C83              MOV     DPH,R4
000A E0                MOVX    A,@DPTR
000B 900000      R     MOV     DPTR,#buffer+03H
000E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1325
000F 0D                INC     R5
0010 BD0001            CJNE    R5,#00H,?C0225
0013 0C                INC     R4
0014         ?C0225:
                                           ; SOURCE LINE # 1326
0014 8D82              MOV     DPL,R5
0016 8C83              MOV     DPH,R4
0018 E0                MOVX    A,@DPTR
0019 900000      R     MOV     DPTR,#buffer+02H
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1327
001D 0D                INC     R5
001E BD0001            CJNE    R5,#00H,?C0226
0021 0C                INC     R4
0022         ?C0226:
                                           ; SOURCE LINE # 1328
0022 8D82              MOV     DPL,R5
0024 8C83              MOV     DPH,R4
0026 E0                MOVX    A,@DPTR
0027 900000      R     MOV     DPTR,#buffer+01H
002A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1329
002B 0D                INC     R5
002C BD0001            CJNE    R5,#00H,?C0227
002F 0C                INC     R4
0030         ?C0227:
                                           ; SOURCE LINE # 1330
0030 8D82              MOV     DPL,R5
0032 8C83              MOV     DPH,R4
0034 E0                MOVX    A,@DPTR
0035 900000      R     MOV     DPTR,#buffer
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1333
;---- Variable 'index' assigned to Register 'R6' ----
0039 E4                CLR     A
003A FE                MOV     R6,A
003B         ?C0193:
                                           ; SOURCE LINE # 1334
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 68  

                                           ; SOURCE LINE # 1335
003B C28E              CLR     TR1
                                           ; SOURCE LINE # 1336
003D C2AB              CLR     ET1
                                           ; SOURCE LINE # 1337
003F 00                NOP     
                                           ; SOURCE LINE # 1338
0040 00                NOP     
                                           ; SOURCE LINE # 1339
0041 00                NOP     
                                           ; SOURCE LINE # 1340
0042 00                NOP     
                                           ; SOURCE LINE # 1341
                                           ; SOURCE LINE # 1342
                                           ; SOURCE LINE # 1343
                                           ; SOURCE LINE # 1344
0043 120000      R     LCALL   L?0270
0046         ?C0196:
                                           ; SOURCE LINE # 1346
0046 900000      E     MOV     DPTR,#PM3STS
0049 E0                MOVX    A,@DPTR
004A 30E00B            JNB     ACC.0,?C0197
                                           ; SOURCE LINE # 1347
                                           ; SOURCE LINE # 1348
004D 308F04            JNB     TF1,?C0198
                                           ; SOURCE LINE # 1349
                                           ; SOURCE LINE # 1350
0050 7F01              MOV     R7,#01H
                                           ; SOURCE LINE # 1351
0052 8004              SJMP    ?C0197
                                           ; SOURCE LINE # 1352
0054         ?C0198:
                                           ; SOURCE LINE # 1354
                                           ; SOURCE LINE # 1355
0054 E4                CLR     A
0055 FF                MOV     R7,A
                                           ; SOURCE LINE # 1356
                                           ; SOURCE LINE # 1357
0056 80EE              SJMP    ?C0196
0058         ?C0197:
                                           ; SOURCE LINE # 1359
0058 EF                MOV     A,R7
0059 6401              XRL     A,#01H
005B 6005              JZ      ?C0194
                                           ; SOURCE LINE # 1360
                                           ; SOURCE LINE # 1361
                                           ; SOURCE LINE # 1362
                                           ; SOURCE LINE # 1364
                                           ; SOURCE LINE # 1366
                                           ; SOURCE LINE # 1367
005D         ?C0195:
005D 0E                INC     R6
005E EE                MOV     A,R6
005F B404D9            CJNE    A,#04H,?C0193
0062         ?C0194:
                                           ; SOURCE LINE # 1369
                                           ; SOURCE LINE # 1370
                                           ; SOURCE LINE # 1371
0062 120000      R     LCALL   L?0273
                                           ; SOURCE LINE # 1372
0065 22                RET     
             ; FUNCTION PECI_PSTReadErrorCount (END)
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 69  


             ; FUNCTION PECI_PSTReadStatus (BEGIN)
                                           ; SOURCE LINE # 1377
                                           ; SOURCE LINE # 1378
                                           ; SOURCE LINE # 1379
0000 C28E              CLR     TR1
                                           ; SOURCE LINE # 1380
0002 C2AB              CLR     ET1
                                           ; SOURCE LINE # 1381
0004 00                NOP     
                                           ; SOURCE LINE # 1382
0005 00                NOP     
                                           ; SOURCE LINE # 1383
0006 00                NOP     
                                           ; SOURCE LINE # 1384
0007 00                NOP     
                                           ; SOURCE LINE # 1385
                                           ; SOURCE LINE # 1386
                                           ; SOURCE LINE # 1387
                                           ; SOURCE LINE # 1388
0008 120000      R     LCALL   L?0271
000B         ?C0203:
                                           ; SOURCE LINE # 1390
000B 900000      E     MOV     DPTR,#PM3STS
000E E0                MOVX    A,@DPTR
000F 30E003            JNB     ACC.0,?C0204
                                           ; SOURCE LINE # 1391
                                           ; SOURCE LINE # 1392
0012 308FF6            JNB     TF1,?C0203
                                           ; SOURCE LINE # 1393
                                           ; SOURCE LINE # 1394
                                           ; SOURCE LINE # 1395
0015         ?C0204:
                                           ; SOURCE LINE # 1398
                                           ; SOURCE LINE # 1399
                                           ; SOURCE LINE # 1401
0015         ?C0206:
                                           ; SOURCE LINE # 1403
                                           ; SOURCE LINE # 1404
                                           ; SOURCE LINE # 1405
0015 120000      R     LCALL   L?0273
                                           ; SOURCE LINE # 1406
0018 22                RET     
             ; FUNCTION PECI_PSTReadStatus (END)

             ; FUNCTION PECI_ClearPSTVariables (BEGIN)
                                           ; SOURCE LINE # 1411
                                           ; SOURCE LINE # 1412
                                           ; SOURCE LINE # 1413
0000 E4                CLR     A
0001 900000      E     MOV     DPTR,#PSTB_Timer
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1414
0005 900000      E     MOV     DPTR,#PSTB_CmdStatus
0008 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1415
0009 900000      E     MOV     DPTR,#PSTB_RepeatIntervalCount
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1416
000D 900000      E     MOV     DPTR,#PSTB_RepeatCycle
0010 120000      E     LCALL   ?C?LSTKXDATA
0013 00                DB      00H
C51 COMPILER V9.03   OEM_PECI                                                              02/02/2015 14:30:32 PAGE 70  

0014 00                DB      00H
0015 00                DB      00H
0016 00                DB      00H
                                           ; SOURCE LINE # 1417
0017 E4                CLR     A
0018 900000      E     MOV     DPTR,#StressToolReadBufIndex
001B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1418
001C 22                RET     
             ; FUNCTION PECI_ClearPSTVariables (END)

             ; FUNCTION PECI_SendBufferData (BEGIN)
                                           ; SOURCE LINE # 1423
                                           ; SOURCE LINE # 1424
                                           ; SOURCE LINE # 1425
0000 900000      E     MOV     DPTR,#StressToolReadBufIndex
0003 E0                MOVX    A,@DPTR
0004 600D              JZ      ?C0211
                                           ; SOURCE LINE # 1426
                                           ; SOURCE LINE # 1427
0006 900000      E     MOV     DPTR,#PM3STS
0009 E0                MOVX    A,@DPTR
000A 20E006            JB      ACC.0,?C0211
                                           ; SOURCE LINE # 1428
                                           ; SOURCE LINE # 1430
000D 900000      E     MOV     DPTR,#StressToolReadBufIndex
0010 E0                MOVX    A,@DPTR
0011 14                DEC     A
0012 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1431
                                           ; SOURCE LINE # 1432
                                           ; SOURCE LINE # 1433
0013         ?C0211:
0013 22                RET     
             ; FUNCTION PECI_SendBufferData (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2771    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      66
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
